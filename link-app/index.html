
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Dátil Link App</title>

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="../stylesheets/screen-611b0914.css" rel="stylesheet" media="screen" />
    <link href="../stylesheets/print-bccf8c07.css" rel="stylesheet" media="print" />
      <script src="../javascripts/all-c5541673.js"></script>
  </head>

  <body class="link-app link-app_index" data-languages="[&quot;sql&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="../images/navbar-cad8cdcb.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="../images/logo-4c73dfe1.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="sql">Ejemplo SQL</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduccion" class="toc-h1 toc-link" data-title="Introducción">Introducción</a>
          </li>
          <li>
            <a href="#compatibilidad" class="toc-h1 toc-link" data-title="Compatibilidad">Compatibilidad</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#sistema-operativo" class="toc-h2 toc-link" data-title="Sistema Operativo">Sistema Operativo</a>
                  </li>
                  <li>
                    <a href="#bases-de-datos" class="toc-h2 toc-link" data-title="Bases de Datos">Bases de Datos</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#descargas" class="toc-h1 toc-link" data-title="Descargas">Descargas</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#mas-reciente-6-2-3" class="toc-h2 toc-link" data-title="Más reciente (6.2.3)">Más reciente (6.2.3)</a>
                  </li>
                  <li>
                    <a href="#versiones-anteriores" class="toc-h2 toc-link" data-title="Versiones anteriores">Versiones anteriores</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#instalacion" class="toc-h1 toc-link" data-title="Instalación">Instalación</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#preparando-el-ambiente" class="toc-h2 toc-link" data-title="Preparando el ambiente">Preparando el ambiente</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#configuracion" class="toc-h1 toc-link" data-title="Configuración">Configuración</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#base-de-datos" class="toc-h2 toc-link" data-title="Base de datos">Base de datos</a>
                  </li>
                  <li>
                    <a href="#environment-ini" class="toc-h2 toc-link" data-title="environment.ini">environment.ini</a>
                  </li>
                  <li>
                    <a href="#companies-my_company-ini" class="toc-h2 toc-link" data-title="companies/my_company.ini">companies/my_company.ini</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#ejecutar-el-servicio" class="toc-h1 toc-link" data-title="Ejecutar el servicio">Ejecutar el servicio</a>
          </li>
          <li>
            <a href="#queries" class="toc-h1 toc-link" data-title="Queries">Queries</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#facturas" class="toc-h2 toc-link" data-title="Facturas">Facturas</a>
                  </li>
                  <li>
                    <a href="#notas-de-credito" class="toc-h2 toc-link" data-title="Notas de crédito">Notas de crédito</a>
                  </li>
                  <li>
                    <a href="#comprobantes-de-retencion" class="toc-h2 toc-link" data-title="Comprobantes de Retención">Comprobantes de Retención</a>
                  </li>
                  <li>
                    <a href="#guias-de-remision" class="toc-h2 toc-link" data-title="Guías de Remisión">Guías de Remisión</a>
                  </li>
                  <li>
                    <a href="#liquidaciones-de-compra" class="toc-h2 toc-link" data-title="Liquidaciones de compra">Liquidaciones de compra</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#clave-de-acceso" class="toc-h1 toc-link" data-title="Clave de acceso">Clave de acceso</a>
          </li>
          <li>
            <a href="#objetos-comunes" class="toc-h1 toc-link" data-title="Objetos comunes">Objetos comunes</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#emisor" class="toc-h2 toc-link" data-title="Emisor">Emisor</a>
                  </li>
                  <li>
                    <a href="#establecimiento" class="toc-h2 toc-link" data-title="Establecimiento">Establecimiento</a>
                  </li>
                  <li>
                    <a href="#maquina-fiscal" class="toc-h2 toc-link" data-title="Máquina fiscal">Máquina fiscal</a>
                  </li>
                  <li>
                    <a href="#reembolso" class="toc-h2 toc-link" data-title="Reembolso">Reembolso</a>
                  </li>
                  <li>
                    <a href="#documento" class="toc-h2 toc-link" data-title="Documento">Documento</a>
                  </li>
                  <li>
                    <a href="#tipo-de-proveedor" class="toc-h2 toc-link" data-title="Tipo de proveedor">Tipo de proveedor</a>
                  </li>
                  <li>
                    <a href="#info-adicional" class="toc-h2 toc-link" data-title="Info adicional">Info adicional</a>
                  </li>
                  <li>
                    <a href="#persona" class="toc-h2 toc-link" data-title="Persona">Persona</a>
                  </li>
                  <li>
                    <a href="#tipo-de-identificacion" class="toc-h2 toc-link" data-title="Tipo de identificación">Tipo de identificación</a>
                  </li>
                  <li>
                    <a href="#total-impuesto" class="toc-h2 toc-link" data-title="Total Impuesto">Total Impuesto</a>
                  </li>
                  <li>
                    <a href="#impuesto-item" class="toc-h2 toc-link" data-title="Impuesto Item">Impuesto Item</a>
                  </li>
                  <li>
                    <a href="#envio-sri" class="toc-h2 toc-link" data-title="Envío SRI">Envío SRI</a>
                  </li>
                  <li>
                    <a href="#autorizacion-sri" class="toc-h2 toc-link" data-title="Autorización SRI">Autorización SRI</a>
                  </li>
                  <li>
                    <a href="#mensajes-de-respuesta-sri" class="toc-h2 toc-link" data-title="Mensajes de respuesta SRI">Mensajes de respuesta SRI</a>
                  </li>
                  <li>
                    <a href="#item-de-factura" class="toc-h2 toc-link" data-title="Item de factura, nota de crédito y liquidación de compras">Item de factura, nota de crédito y liquidación de compras</a>
                  </li>
                  <li>
                    <a href="#retencion-de-factura" class="toc-h2 toc-link" data-title="Retención en factura ">Retención en factura </a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#catalogo" class="toc-h1 toc-link" data-title="Catálogo">Catálogo</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#tipos-de-impuesto" class="toc-h2 toc-link" data-title="Tipos de impuesto">Tipos de impuesto</a>
                  </li>
                  <li>
                    <a href="#codigo-de-porcentaje-de-iva" class="toc-h2 toc-link" data-title="Código de Porcentaje de IVA">Código de Porcentaje de IVA</a>
                  </li>
                  <li>
                    <a href="#tipos-de-impuesto-para-la-retencion" class="toc-h2 toc-link" data-title="Tipos de impuesto para la retención">Tipos de impuesto para la retención</a>
                  </li>
                  <li>
                    <a href="#tipos-de-impuesto-para-la-retencion-en-la-factura" class="toc-h2 toc-link" data-title="Tipos de impuesto para la retención en la factura">Tipos de impuesto para la retención en la factura</a>
                  </li>
                  <li>
                    <a href="#retencion-de-iva" class="toc-h2 toc-link" data-title="Retención de IVA">Retención de IVA</a>
                  </li>
                  <li>
                    <a href="#retencion-isd" class="toc-h2 toc-link" data-title="Retención ISD">Retención ISD</a>
                  </li>
                  <li>
                    <a href="#retencion-de-iva-presuntivo-y-renta" class="toc-h2 toc-link" data-title="Retención de IVA Presuntivo y Renta">Retención de IVA Presuntivo y Renta</a>
                  </li>
                  <li>
                    <a href="#tipos-de-documentos" class="toc-h2 toc-link" data-title="Tipos de documentos">Tipos de documentos</a>
                  </li>
                  <li>
                    <a href="#tipos-de-forma-de-pago" class="toc-h2 toc-link" data-title="Tipos de forma de pago">Tipos de forma de pago</a>
                  </li>
                  <li>
                    <a href="#tipos-de-forma-de-pago-del-sri" class="toc-h2 toc-link" data-title="Tipos de forma de pago del SRI">Tipos de forma de pago del SRI</a>
                  </li>
                  <li>
                    <a href="#equivalencia-entre-formas-de-pago-datil-y-formas-de-pago-del-sri" class="toc-h2 toc-link" data-title="Equivalencia entre formas de pago Dátil y formas de pago del SRI">Equivalencia entre formas de pago Dátil y formas de pago del SRI</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#ejemplos-de-archivos-de-configuracion" class="toc-h1 toc-link" data-title="Ejemplos de archivos de configuración">Ejemplos de archivos de configuración</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#invoice-ini" class="toc-h2 toc-link" data-title="invoice.ini">invoice.ini</a>
                  </li>
                  <li>
                    <a href="#credit_note-ini" class="toc-h2 toc-link" data-title="credit_note.ini">credit_note.ini</a>
                  </li>
                  <li>
                    <a href="#retention-ini" class="toc-h2 toc-link" data-title="retention.ini">retention.ini</a>
                  </li>
                  <li>
                    <a href="#waybill-ini" class="toc-h2 toc-link" data-title="waybill.ini">waybill.ini</a>
                  </li>
                  <li>
                    <a href="#purchase_settlement-ini" class="toc-h2 toc-link" data-title="purchase_settlement.ini">purchase_settlement.ini</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#actualizacion" class="toc-h1 toc-link" data-title="Actualización">Actualización</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='#'>Para obtener mi clave del API</a></li>
            <li><a href='http://github.com/tripit/slate'>Documentación gracias a Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id='introduccion'>Introducción</h1>
<p>Integra tu sistema contable o ERP con Facturación Electrónica. La aplicación
<strong>Link</strong> de Dátil te permite emitir todos los tipos de comprobantes
electrónicos: facturas, retenciones, notas de crédito, notas de débito y
guías de remisión.</p>

<p>Link funciona como un servicio del sistema operativo, de esta manera se mantiene
en ejecución permanente emitiendo comprobantes.</p>

<p><strong>Link</strong> se conecta a la base de datos de tu ERP o sistema contable para obtener
la información de los comprobantes mientras sigues usando tu sistema como
siempre lo has hecho.</p>

<p><strong>¿Cómo funciona?</strong></p>

<ul>
<li>Link consulta los documentos utilizando las sentencias SQL de los archivos de
configuración.</li>
<li>Registra los nuevos documentos detectados en una tabla de Control.</li>
<li>La <em>tarea de emisión</em> de Link toma de la tabla de Control el ID del documento
(id_local) en las tablas o vistas del ERP y consulta toda la información de
todas las tablas/vistas relacionadas establecidas en la configuración.</li>
<li>Si el intento de emisión del documento fue exitoso, Link actualiza la tabla
de Control con el estado <em>RECIBIDO</em></li>
<li>La <em>tarea de consulta de resultado</em> consulta al servicio de Dátil el estado
de autorización del documento hasta obtener un estado final (AUTORIZADO,
NO AUTORIZADO o DEVUELTO).</li>
</ul>
<h1 id='compatibilidad'>Compatibilidad</h1><h2 id='sistema-operativo'>Sistema Operativo</h2>
<p>Link es compatible con los siguientes sistemas operativos:</p>

<p><strong>Windows</strong></p>

<p><em>Disponible para 32 y 64 bits</em></p>

<ul>
<li>Windows Server 2003</li>
<li>Windows Server 2008</li>
<li>Windows Server 2012</li>
<li>Windows XP</li>
<li>Windows Vista</li>
<li>Windows 7</li>
<li>Windows 8</li>
</ul>

<p>Para saber si la versión de su equipo es de 32 o 64 bits en Windows, sigue los
pasos del <a href="https://support.microsoft.com/es-es/kb/827218">siguiente enlace</a>.</p>

<p><strong>Linux</strong> (próximamente)</p>

<ul>
<li>CentOS</li>
</ul>
<h2 id='bases-de-datos'>Bases de Datos</h2>
<p>Link utiliza ODBC para interactuar con la base de datos, por lo que si el
sistema de base de datos que utiliza tu sistema tiene un controlador ODBC Link
debería funcionar sin problemas.</p>

<p>Consulta la documentación del driver ODBC que utilizas para construir la cadena
de conexión (connection string). El sitio web <a href="https://www.connectionstrings.com/">www.connectionstrings.com</a> también puede ser de utilidad. Este sitio tiene documentación sobre varios motores de base de datos y drivers ODBC.</p>

<p>Link ha sido probado y es utilizado en producción en estos motores de base de
datos.</p>
<h3 id='sql-server'>SQL Server</h3>
<ul>
<li>SQL Server 2000</li>
<li>SQL Server 2005</li>
<li>SQL Server 2008</li>
<li>SQL Server 2012</li>
<li>SQL Server 2014</li>
</ul>
<h3 id='sybase'>Sybase</h3><h3 id='oracle'>ORACLE</h3><h3 id='mysql'>MySQL</h3><h1 id='descargas'>Descargas</h1>
<p>Integra Dátil a tu sistema en minutos.</p>
<h3 id='mas-reciente-6-2-3'>Más reciente (6.2.3)</h3>
<ul>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_6.2.3_32bit.exe">Windows 32 bits</a></li>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_6.2.3_64bit.exe">Windows 64 bits</a></li>
</ul>
<h4 id='notas-de-la-version'>Notas de la versión</h4><h4 id='6-2-3enero-15-2020'><strong>6.2.3</strong><br><small><strong>Enero 15, 2020</strong></small></h4><h5 id='corregido'>Corregido</h5>
<p>Error al momento de emitir una liquidación de compra.</p>
<h3 id='versiones-anteriores'>Versiones anteriores</h3><h4 id='6-2-2'>6.2.2</h4>
<ul>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_6.2.2_32bit.exe">Windows 32 bits</a></li>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_6.2.2_64bit.exe">Windows 64 bits</a></li>
</ul>
<h4 id='notas-de-la-version-2'>Notas de la versión</h4><h4 id='6-2-2enero-3-2020'><strong>6.2.2</strong><br><small><strong>Enero 3, 2020</strong></small></h4><h5 id='corregido-2'>Corregido</h5>
<p>Mejora en información de pagos para compatibilidad con Oracle.</p>
<h4 id='6-2-1'>6.2.1</h4>
<ul>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_6.2.1_32bit.exe">Windows 32 bits</a></li>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_6.2.1_64bit.exe">Windows 64 bits</a></li>
</ul>
<h4 id='notas-de-la-version-3'>Notas de la versión</h4><h4 id='6-2-1diciembre-24-2019'><strong>6.2.1</strong><br><small><strong>Diciembre 24, 2019</strong></small></h4><h5 id='corregido-3'>Corregido</h5>
<p>Error al momento de obtener información de una liquidación de compras sin que ésta tenga registrada una máquina fiscal.</p>
<h4 id='6-2-0'>6.2.0</h4>
<ul>
<li>Windows 32 bits</li>
<li>Windows 64 bits</li>
</ul>
<h4 id='notas-de-la-version-4'>Notas de la versión</h4><h4 id='6-2-0octubre-30-2019'><strong>6.2.0</strong><br><small><strong>Octubre 30, 2019</strong></small></h4><h5 id='nuevo'>Nuevo</h5>
<p>Soporte para Microsoft Access. </p>
<h4 id='6-1-0'>6.1.0</h4>
<ul>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_6.1.0_32bit_generic.exe">Windows 32 bits</a></li>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_6.1.0_64bit_generic.exe">Windows 64 bits</a></li>
</ul>
<h4 id='notas-de-la-version-5'>Notas de la versión</h4><h4 id='6-1-0octubre-24-2019'><strong>6.1.0</strong><br><small><strong>Octubre 24, 2019</strong></small></h4><h5 id='nuevo-2'>Nuevo</h5>
<p>Soporte para poder liquidaciones de compra</p>
<h5 id='corregido-4'>Corregido</h5>
<p>Corrige error de regresión en la tarea <code>sync_company_resources</code></p>
<h4 id='5-0-1'>5.0.1</h4>
<ul>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_5.0.1_32bit.exe">Windows 32 bits</a></li>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_5.0.1_64bit.exe">Windows 64 bits</a></li>
</ul>
<h4 id='notas-de-la-version-6'>Notas de la versión</h4><h4 id='5-0-1enero-5-2018'><strong>5.0.1</strong><br><small><strong>Enero 5, 2018</strong></small></h4><h5 id='corregido-5'>Corregido</h5>
<p>La longitud máxima para el nombre de una columna en versiones de ORACLE menores
a la 12 es de 30 caracteres. Por esto agregamos alias más cortos para parámetros
que exceden esta longitud, como <code>fecha_emision_documento_sustento -&gt; fecha_emi_doc_sustento</code>,
<code>numero_autorizacion_documento_sustento -&gt; num_aut_doc_sustento</code></p>
<h4 id='5-0-0'>5.0.0</h4>
<ul>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_5.0.0_32bit.exe">Windows 32 bits</a></li>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_5.0.0_64bit.exe">Windows 64 bits</a></li>
</ul>
<h4 id='notas-de-la-version-7'>Notas de la versión</h4><h4 id='5-0-0enero-5-2018'><strong>5.0.0</strong><br><small><strong>Enero 5, 2018</strong></small></h4><h5 id='nuevo-3'>Nuevo</h5>
<p>Soporte para ORACLE.<br/>
Personalización del formato de fecha utilizado como literal de fecha utilizando
la nueva entrada de configuración <code>datetime_format</code>.<br/></p>
<h5 id='removido'>Removido</h5>
<p>La tarea <code>sync_resources</code> fue removida completamente en favor de tarea más
reciente <code>resource_sync</code>.</p>
<h4 id='4-7-0'>4.7.0</h4>
<ul>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_4.7.0_32bit.exe">Windows 32 bits</a></li>
<li><a href="https://s3-us-west-2.amazonaws.com/linkapp-installers/Datil+LinkApp_4.7.0_64bit.exe">Windows 64 bits</a></li>
</ul>
<h4 id='notas-de-la-version-8'>Notas de la versión</h4><h4 id='4-7-0octubre-19-2017'><strong>4.7.0</strong><br><small><strong>Octubre 19, 2017</strong></small></h4><h5 id='nuevo-4'>Nuevo</h5>
<p>Emisión de facturas de reembolso. Se agregaron tres nuevas entradas al archivo
de configuración <code>config/receipts/invoice.ini</code>: invoice_reimbursement,
invoice_reimbursement_document, invoice_reimbursement_document_tax</p>
<h1 id='instalacion'>Instalación</h1>
<p>Luego de descargar el instalador, empiece la instalación con doble click, siguiendo
el flujo de ventanas que aparecerán en su pantalla.</p>

<p><img src='../images/linkapp/install-step-1-a485a723.png'></img>
<img src='../images/linkapp/install-step-3-3719ef11.png'></img>
<img src='../images/linkapp/install-step-4-9c8f1371.png'></img>
<img src='../images/linkapp/install-step-5-f9197378.png'></img></p>
<h2 id='preparando-el-ambiente'>Preparando el ambiente</h2>
<p>Link utiliza dos tablas indispensables para su operación: Control y Mensaje.
En la tabla de Control registra los documentos que debe procesar y el estado de
cada uno de ellos. Puedes crear estas tablas en la misma base de datos de tu
ERP o en una distinta.</p>

<p>Crea la tabla de control y mensaje:</p>

<pre>
CREATE TABLE Control (
    id_control bigint IDENTITY(1,1) NOT NULL PRIMARY KEY,
    tipo_comprobante int NOT NULL,
    id_local varchar(100) NOT NULL,
    numero_comprobante varchar(20) NOT NULL,
    estado varchar(13),
    numero_autorizacion varchar(100),
    fecha_autorizacion datetime,
    fecha_emision datetime,
    fecha_ingreso datetime,
    fecha_ultimo_envio datetime,
    clave_acceso varchar(50),
    id_externo varchar(40),
    company_name varchar(40),
    CONSTRAINT ix_tipo_idlocal UNIQUE (tipo_comprobante, id_local, numero_comprobante, company_name)
  )
</pre>

<pre>
CREATE TABLE
    Mensaje(
    id_control bigint,
    identificador varchar(2) NOT NULL,
    mensaje TEXT NOT NULL,
    tipo varchar(50) NOT NULL,
    fecha_creacion datetime NOT NULL,
    CONSTRAINT pk_comprobante_identificador PRIMARY KEY (id_control, identificador),
    CONSTRAINT fk_control_id FOREIGN KEY (id_control) REFERENCES Control(id_control)
    )
</pre>

<p>Creando índices para la tabla de control:</p>

<pre>
CREATE NONCLUSTERED INDEX estado ON Control 
(
    tipo_comprobante ASC,
    estado ASC,
    company_name ASC
) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON PRIMARY
</pre>

<pre>
ALTER TABLE Control ADD  CONSTRAINT ix_tipo_idlocal UNIQUE NONCLUSTERED 
(
    tipo_comprobante ASC,
    id_local ASC,
    numero_comprobante ASC,
    company_name ASC
) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON PRIMARY
</pre>

<pre>
CREATE NONCLUSTERED INDEX IX_Control_tipo_fecha ON Control 
(
    tipo_comprobante ASC,
    fecha_emision ASC,
    company_name ASC
) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON PRIMARY
</pre>
<h1 id='configuracion'>Configuración</h1>
<p>Link utiliza archivos de configuración en formato .ini que contienen todos los
parámetros que se pueden ajustar. Puesto que los archivos de configuración se
encuentran en la carpeta de <code>C:\Archivos de Progama\Datil\Link\config</code> para
editarlos debes abrir siempre tu editor con permisos de administrador.</p>

<p>Los <a href="https://es.wikipedia.org/wiki/INI_(extensi%C3%B3n_de_archivo)">archivos INI</a>
están compuestos por secciones y cada sección puede tener varias claves y
valores.</p>
<h2 id='base-de-datos'>Base de datos</h2>
<p>Cómo lo describimos en la sección de <em>Introducción</em> Link utiliza una tabla de
control para mantener un registro de los documentos que ya ha procesado. Este
registro contiene información como el estado, la fecha de registro en la tabla
de control, la fecha y el número de autorización y el ID (id_externo) del
documento en Datil.</p>

<p>En el archivo <a href="#environment-ini">environment.ini</a> va la configuración de la
conexión a la base donde se encuentran las tablas de control y mensaje.
En el archivo <a href="#companies-my_company-ini">companies/my company.ini</a> debes
configurar la conexión a la base de datos donde están las tablas/vistas desde
las que Link extraerá la información de los documentos.</p>

<p>Esta separación permite a Link funcionar en estos escenarios:
- Emitir documentos de más de una compañía en un sistema ERP que almacena los
documentos de cada compañía en una base de datos diferente.
- Mantener la base de datos en la que puede <em>escribir</em> Link completamente aislada
de la base de datos de la que sólo puede <em>leer</em> Link.</p>

<p>A partir de la versión <a href="#6-0-0">6.0.0</a> existen dos maneras de especificar los
parámetros de conexión a la base de datos:</p>
<h3 id='simplificada'>Simplificada</h3>
<p>Link tiene la capacidad de construir la cadena de conexión para los siguientes
drivers ODBC: SQL Anywhere 11, Microsoft ODBC for Oracle, Oracle in OraClient11g_home1,
Microsoft ODBC Driver for Oracle, SQL Server y Access ODBC Driver. Si utilizas alguno de estos drivers
debes especificar los siguientes parámetros:</p>

<table><thead>
<tr>
<th>Parámetros</th>
<th>&nbsp;</th>
</tr>
</thead><tbody>
<tr>
<td>driver</td>
<td>Controlador cuando se establece una conexión por ODBC.</td>
</tr>
<tr>
<td>server</td>
<td>Dirección o nombre del servidor</td>
</tr>
<tr>
<td>name</td>
<td>Nombre de la base de datos</td>
</tr>
<tr>
<td>user</td>
<td>Nombre de usuario.</td>
</tr>
<tr>
<td>password</td>
<td>Contraseña del usuario de la base de datos</td>
</tr>
<tr>
<td>version<p class="dt-data-param-required">requerido</p></td>
<td>Versión del motor de base de datos que se utiliza para constriur SQL dependiendo de la versión</td>
</tr>
<tr>
<td>connection_string</td>
<td>Permite especificar la cadena de conexión ODBC para conectarse a la base. Si especificas este parámetro todos los otros parámetros de conexión como driver, server, name, user y password serán ignorados. Debes especificar este parámetro o el conjunto de parámetros driver, server, name, user, password.</td>
</tr>
<tr>
<td>api<p class="dt-data-param-required">requerido</p></td>
<td>Puede ser <code>odbc</code> o <code>adodb</code></td>
</tr>
<tr>
<td>data_source<p class="dt-data-param-required">requerido</p></td>
<td>Utilizado para conexiones tipo <code>adodb</code></td>
</tr>
<tr>
<td>provider<p class="dt-data-param-required">requerido</p></td>
<td>Utilizado para conexiones tipo <code>adodb</code></td>
</tr>
<tr>
<td>datetime_format</td>
<td>Formato de la representación literal de un SQL_TIMESTAMP. Por ejemplo en SQL Server el literal de un <code>DATETIME</code> es %Y-%m-%d %H:%M:%S</td>
</tr>
</tbody></table>
<h3 id='cadena-de-conexion-connection-string-explicita'>Cadena de conexión (connection string) explícita</h3>
<p>La nueva manera a partir de la versión 6.0.0 de conexión sólo requiere que se
especifique el parámetro <code>connection_string</code>. Así es posible utilizar cualquier
motor de base de datos o controlador no soportado por la manera simplificada de
conexión.</p>

<p>Esta es la manera de conexión recomendada a partir de la versión 6.0.0 de Link.</p>
<h4 id='ejemplos'>Ejemplos</h4>
<p>Ejemplos de configuración para sistemas de base de datos más comunes</p>
<h5 id='sql-server'>SQL Server</h5><pre class="highlight ini tab-ini"><code><span class="py">driver</span> <span class="p">=</span> <span class="s">SQL Server</span>
<span class="py">server</span> <span class="p">=</span> <span class="s">ADMIN</span><span class="se">\S</span><span class="s">QLEXPRESS.</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">DATIL</span>
<span class="py">user</span> <span class="p">=</span> <span class="s">link</span>
<span class="py">password</span> <span class="p">=</span> <span class="s">Link007</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">2012</span>
<span class="py">api</span> <span class="p">=</span> <span class="s">odbc</span>
<span class="py">datasource</span> <span class="p">=</span> <span class="s">None</span>
<span class="py">provider</span>   <span class="p">=</span> <span class="s">None</span>
</code></pre><h5 id='oracle'>Oracle</h5><pre class="highlight ini tab-ini"><code><span class="nn">[DatabaseSource]</span>
<span class="py">driver</span> <span class="p">=</span> <span class="s">Microsoft ODBC for Oracle</span>
<span class="py">server</span> <span class="p">=</span> <span class="s">mydbserver</span>
<span class="py">name</span> <span class="p">=</span>
<span class="py">user</span> <span class="p">=</span> <span class="s">link</span>
<span class="py">password</span> <span class="p">=</span> <span class="s">datil</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">10</span>
<span class="py">api</span> <span class="p">=</span> <span class="s">odbc</span>
<span class="py">data_source</span> <span class="p">=</span> <span class="s">None</span>
<span class="py">provider</span> <span class="p">=</span> <span class="s">None</span>
<span class="py">datetime_format</span> <span class="p">=</span> <span class="s">%Y-%m-%d %H:%M:%S.%f'</span>
</code></pre><h5 id='mysql'>MySQL</h5><pre class="highlight ini tab-ini"><code><span class="nn">[DatabaseSource]</span>
<span class="py">connection_string</span> <span class="p">=</span> <span class="s">DRIVER={MySQL ODBC 8.0 ANSI Driver};SERVER=localhost;DATABASE=datil;USER=link;PASSWORD=Link007;OPTION=3</span>
<span class="py">driver</span> <span class="p">=</span>
<span class="py">server</span> <span class="p">=</span>
<span class="py">name</span> <span class="p">=</span>
<span class="py">user</span> <span class="p">=</span>
<span class="py">password</span> <span class="p">=</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">8.0</span>
<span class="py">api</span> <span class="p">=</span> <span class="s">odbc</span>
<span class="py">data_source</span> <span class="p">=</span> <span class="s">None</span>
<span class="py">provider</span> <span class="p">=</span> <span class="s">None</span>
</code></pre>
<p>Consulta la documentación del driver ODBC que utilizas, o busca en la sitio web
<a href="https://www.connectionstrings.com">www.connectionstrings.com</a> la documentación
del motor de base de datos que utilizas.</p>
<h2 id='environment-ini'>environment.ini</h2>
<p>Parámetros generales del ambiente. Contiene las siguientes secciones.</p>
<h3 id='databasesource'>[DatabaseSource]</h3>
<p>Revisa la sección de configuración de <a href="#base-de-datos">base de datos</a> para más
información</p>
<h3 id='scheduler'>[Scheduler]</h3>
<p>Las tareas de emisión, consulta y sincronización se ejecutan al iniciar el
servicio y luego esperan el tiempo establecido por estos parámetros antes de
volver a ejecutarse. Todos estos valores se especifican en segundos.</p>

<table><thead>
<tr>
<th>Parámetros</th>
<th>&nbsp;</th>
</tr>
</thead><tbody>
<tr>
<td>issue_receipts_interval<p class="dt-data-param-required">requerido</p></td>
<td>Intervalo para la tarea de <em>emisión</em> de documentos.</td>
</tr>
<tr>
<td>read_receipts_interval<p class="dt-data-param-required">requerido</p></td>
<td>Intervalo para la tarea de <em>consulta de estado</em> de documentos.</td>
</tr>
<tr>
<td>issue_receipts_from_xml_interval<p class="dt-data-param-required">requerido</p></td>
<td>Intervalo para la tarea de <em>emisión por xml</em>.</td>
</tr>
<tr>
<td>send_status_interval<p class="dt-data-param-required">requerido</p></td>
<td>Intervalo para la tarea de reporte de estado (aun no utilizada)</td>
</tr>
<tr>
<td>sync_resources_interval<p class="dt-data-param-required">requerido</p></td>
<td>Intervalo para la tarea de <em>sincronización de recursos</em>.</td>
</tr>
</tbody></table>
<h3 id='constraints'>[Constraints]</h3>
<p>Restricciones para la consulta de documentos.</p>

<table><thead>
<tr>
<th>Parámetros</th>
<th>&nbsp;</th>
</tr>
</thead><tbody>
<tr>
<td>issue_limit<p class="dt-data-param-required">requerido</p></td>
<td>Número máximo de documentos que la tarea de <em>emisión</em> de documentos toma cada vez que se ejecuta. Existe un problema conocido en bases de datos ORACLE que impide establecer este parámetro en un valor diferente a uno.</td>
</tr>
<tr>
<td>issue_order<p class="dt-data-param-required">requerido</p></td>
<td>Determina el ordenamiento de los documentos consultados para emitir. Puede ser <code>ASC</code> o <code>DESC</code></td>
</tr>
<tr>
<td>get_info_limit<p class="dt-data-param-required">requerido</p></td>
<td>Número máximo de documentos que la tarea de <em>consulta de estado</em> de documentos toma cada vez que se ejecuta.</td>
</tr>
<tr>
<td>get_info_order<p class="dt-data-param-required">requerido</p></td>
<td>Determina el ordenamiento de los documentos consultados para obtener su estado. Puede ser <code>ASC</code> o <code>DESC</code></td>
</tr>
<tr>
<td>first_receipt_date<p class="dt-data-param-required">requerido</p></td>
<td>Establece la fecha a partir de la cual necesitas emitir documentos. La fecha debe tener el formato <code>YYYY-mm-dd hh:MM:SS</code> ejemplo: <code>2002-09-12 13:40:00</code> para el 12 de septiembre del año 2002 a las trece horas con cuarenta minutos y cero segundos.</td>
</tr>
<tr>
<td>max_days_to_query<p class="dt-data-param-required">requerido</p></td>
<td>El número máximo de días previos a consultar a partir de la fecha actual. Normalmente se configura con 30 puesto que es el límite de fecha de emisión establecido por el SRI para emitir un documento electrónico.</td>
</tr>
<tr>
<td>new_receipts_limit<p class="dt-data-param-required">requerido</p></td>
<td>Número máximo de documentos que la tarea de <em>control</em> inserta a la tabla de Control cada vez que se ejecuta.</td>
</tr>
</tbody></table>
<h2 id='companies-my_company-ini'>companies/my_company.ini</h2>
<p>No es necesario, pero te recomendamos renombrar este archivo con un nombre
corto de tu empresa, sobretodo si vas a utilizar una instalación de Link para
varias empresas. Link utiliza el nombre de este archivo para garantizar que los
registros en la tabla de <em>control</em> sean únicos para cada compañía, esto es lo
que verás en el campo <code>company_name</code> una vez que Link empiece a funcionar e
inserte registros en la tabla de control.
Utiliza sólo letras, números, guiones o sub-guiones para el nombre del archivo.
Ejemplo: <code>acme_inc</code></p>
<h3 id='general'>[General]</h3>
<p>En la sección <code>[General]</code> configura el parámetro <code>ruc</code> con el ruc de la empresa.</p>
<h3 id='api'>[Api]</h3>
<p>En la sección <code>[Api]</code> configura el parámetro <code>xkey</code> con el <em>API key</em> de Dátil y
<code>xpassword</code> con la clave del certificado de firma electrónica, <code>environment</code>
con el valor <code>1</code> para emisión en modo de pruebas o <code>2</code> para emitir en producción.</p>
<h3 id='issuefromdatabase'>[IssueFromDatabase]</h3>
<p>Los parámetros de esta sección te permiten encender o apagar la <em>tarea de emisión</em>
desde la base de datos para cada tipo de comprobante para esta compañía. Los
posibles valores para estos parámetros son <code>yes</code> o <code>no</code>. El valor <code>yes</code> le
indica a Link que debe encender la tarea y <code>no</code> que debe apagarla.</p>
<h3 id='issuefromxml'>[IssueFromXml]</h3>
<p>Estos parámetros permiten encender o apagar la <em>tarea de emisión por xml</em>.</p>
<h3 id='read'>[Read]</h3>
<p>Estos parámetros permiten encender o apagar la <em>tarea de consulta</em> de
autorización.</p>
<h3 id='databasesource-2'>[DatabaseSource]</h3>
<p>Revisa la sección de configuración de <a href="#base-de-datos">base de datos</a> para más
información.</p>
<h3 id='xmlsource'>[XmlSource]</h3>
<p>Configuración de las rutas de los directorios donde se encuentran los archivos
XML. Esto aplica para la emisión por XML.</p>
<h3 id='sincronizacion-y-eventos'>Sincronización y Eventos</h3>
<p>Link tiene la habilidad de suscribirse a <a href="https://datil.dev/next/events">eventos</a>
emitidos por Datil y ejecutar sentencias SQL y descargar archivos. Cualquier
atributo del evento que contenga la dirección a un recurso (URI) válido puede
ser descargado y almacenado en un directorio del sistema.</p>

<p>El nombre de la sección para cada configuración es el nombre del evento, de
esta manera podrás tener configuraciones diferentes para cada evento.</p>

<p>Estos son los parámetros de configuración para cada evento:</p>

<table><thead>
<tr>
<th>Parámetros</th>
<th>&nbsp;</th>
</tr>
</thead><tbody>
<tr>
<td>download_files<p class="dt-data-param-required">requerido</p></td>
<td>Activa o inactiva el proceso de descarga de archivos. Puede ser <em>yes</em> o <em>no</em></td>
</tr>
<tr>
<td>update_tables<p class="dt-data-param-required">requerido</p></td>
<td>Activa o inactiva el proceso de ejecución de SQL. Puede ser <em>yes</em> o <em>no</em></td>
</tr>
<tr>
<td>formats_to_download<p class="dt-data-param-required">requerido</p></td>
<td>Especifica este valor si <code>download_files</code> está activo. Puede ser una lista de valores separados por coma o la palabra reservada <em>all</em>. Si utilizas la palabra <em>all</em> intentará descargar los archivos detallados en este mismo parámetro en la sección [Sync] del archivo environment.ini</td>
</tr>
<tr>
<td>download_path</td>
<td>Ruta del directorio donde se descargará los archivos. Requerido si <code>download_files</code> está activo.</td>
</tr>
<tr>
<td>download_path_[ATRIBUTO]</td>
<td>Ruta del directorio donde se descargarán los archivos para el atributo <em>&quot;ATRIBUTO&quot;</em>. Puedes personalizar esta ruta utilizando condicionales, lazos, macros, bloques, variables, etiquetas disponibles en <a href="http://jinja.pocoo.org/">Jinja2</a>.</td>
</tr>
<tr>
<td>update_tables_sentences</td>
<td>Sentencias SQL a ejecutar cuando el evento sea recibido. Puedes personalizar este SQL utilizando condicionales, lazos, macros, bloques, variables disponibles en <a href="http://jinja.pocoo.org/">Jinja2</a>. Requerido si <code>update_tables</code> está activo.</td>
</tr>
</tbody></table>

<h4 class="dt-section">Ejemplo de descarga en un solo directorio</h4>
<pre class="highlight ini tab-ini"><code><span class="nn">[invoice.received]</span>
<span class="py">download_files</span> <span class="p">=</span> <span class="s">yes</span>
<span class="py">update_tables</span> <span class="p">=</span> <span class="s">yes</span>
<span class="py">formats_to_download</span> <span class="p">=</span> <span class="s">printable_version_url, electronic_document_url</span>
<span class="py">download_path</span> <span class="p">=</span> <span class="s">C:/Documentos Recibidos/</span>
<span class="py">update_tables_sentences</span> <span class="p">=</span> <span class="s">UPDATE factura</span>
  <span class="err">SET</span> <span class="py">numero_autorizacion</span> <span class="p">=</span> <span class="s">'{{ authorization.number }}'</span>
  <span class="err">WHERE</span> <span class="py">numero</span> <span class="p">=</span> <span class="s">'{{ number }}'</span>
</code></pre>
<p>De esta manera podrías, por ejemplo, actualizar información en una tabla de tu
base de datos y descargar el PDF (<code>printable_version_url</code>) y el documento
electrónico XML (<code>electronic_document_url</code>) cada vez que en tu cuenta Dátil
recibas una factura de compra (invoice.received). La configuración luciría así:</p>

<h4 class="dt-section">Ejemplo de descarga con un directorio diferente para cada archivo</h4>
<pre class="highlight ini tab-ini"><code><span class="nn">[invoice.received]</span>
<span class="py">download_files</span> <span class="p">=</span> <span class="s">yes</span>
<span class="py">update_tables</span> <span class="p">=</span> <span class="s">yes</span>
<span class="py">formats_to_download</span> <span class="p">=</span> <span class="s">printable_version_url, electronic_document_url</span>
<span class="py">download_path_printable_version_url</span> <span class="p">=</span> <span class="s">C:/Documentos Recibidos/{{ issue_date_date.year }}/{{ issue_date_month_name }}/pdf/</span>
<span class="py">download_path_electronic_document_url</span> <span class="p">=</span> <span class="s">C:/Documentos Recibidos/{{ issue_date_date.year }}/{{ issue_date_month_name }}/xml/</span>
<span class="py">update_tables_sentences</span> <span class="p">=</span> <span class="s">UPDATE factura</span>
  <span class="err">SET</span> <span class="py">numero_autorizacion</span> <span class="p">=</span> <span class="s">'{{ authorization.number }}'</span>
  <span class="err">WHERE</span> <span class="py">numero</span> <span class="p">=</span> <span class="s">'{{ number }}'</span>
</code></pre>
<p>Si quisieras almacenar los archivos en directorios separados podrías configurar
el evento de esta manera.</p>

<aside class="notice">
El nombre del archivo tomará el nombre establecido por el servidor del
archivo a través de la cabecera HTTP Content-Disposition. Si esta cabecera no
está presente, se utilizará el ID del recurso contenido en el evento para dar
nombre al archivo.
</aside>
<h1 id='ejecutar-el-servicio'>Ejecutar el servicio</h1>
<p>En el menú <code>Inicio</code> buscar el <code>Simbolo del Sistema</code> , darle click derecho y escoger la opción <code>Ejecutar como administrador</code>.</p>

<p>Luego para iniciar el servicio ejecutar el comando:</p>

<p><code>net start datilink</code></p>

<p>Enter.</p>

<p>Si desea detener el servicio, ejecutar:</p>

<p><code>net stop datilink</code></p>
<h1 id='queries'>Queries</h1>
<p><strong>Tablas o Vistas</strong></p>

<p>Para que la aplicación <strong>Link</strong> se conecte a su ERP o sistema contable se deben configurar
los <em>queries</em> para extraer información directamente de las tablas  de su base de datos.</p>

<p>Si no desea que <strong>Link</strong> consulte directamente sus tablas puede crear vistas con la información
de los comprobantes a emitir.</p>

<p><strong>Formato</strong></p>

<p>Los queries se guardan siguiendo el formato de archivos <code>.ini</code>. en el directorio
<em>C:/Archivos de Programa/Datil/Link/config/</em>.</p>

<p>En cada archivo <code>.ini</code> cada <em>query</em> está asignado a una variable.</p>

<p>Si aún no ha instalado <strong>Link</strong>, puede crear un archivo <code>.ini</code> de respaldo con los queries configurados.</p>

<p><a href="#ejemplos-de-archivos-de-configuracion">Ver ejemplos de archivos de configuración</a></p>

<p><strong>Nombres de tablas y columnas</strong></p>

<p>Sea directamente o por medio de vistas, dependiendo de su sistema, deberá cambiar los nombres de las tablas  al configurar los <em>queries</em>.</p>

<p>Los nombres de las columnas en las tablas
de su sistema pueden ser distintos pero el resultado de cada <em>query</em> debe tener los nombres establecidos en esta documentación.</p>

<p><strong>Queries opcionales</strong></p>

<p>Algunos queries son opcionales porque la información que extraen no es obligatoria para el SRI, en este caso la variable que se configura en el archivo <code>.ini</code> debe tener asignada el valor de <code>None</code>.</p>

<p>Ejemplo:</p>

<p><code>invoice_additional_information = None</code></p>

<p><code>item_details = None</code></p>
<h2 id='facturas'>Facturas</h2>
<p>Los queries para la emisión electrónica de <strong>facturas</strong> se guardan en el archivo de configuración <code>invoice.ini</code>.</p>

<p><a href="/link-app#invoice-ini">Ejemplo de archivo invoice.ini</a></p>
<h3 id='cabecera'>Cabecera</h3>
<p>Obtiene información de la cabecera de la factura.</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_factura</span>            <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_emision</span><span class="p">,</span>
  <span class="n">guia_remision</span><span class="p">,</span>
  <span class="n">moneda</span><span class="p">,</span>
  <span class="n">clave_acceso</span><span class="p">,</span>
  <span class="n">tipo_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">info</span><span class="p">.</span><span class="n">id_factura</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id_factura</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la factura. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la factura. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision</td>
<td>datetime</td>
<td>Fecha de emisión   <strong>Requerido</strong></td>
</tr>
<tr>
<td>guia_remision</td>
<td>string</td>
<td>Número de guía de remisión asociada a esta factura en formato 001-002-000000003 ([0-9]{3}-[0-9]{3}-[0-9]{9})</td>
</tr>
<tr>
<td>moneda</td>
<td>string</td>
<td>Código <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO</a> de la moneda. <strong>Requerido</strong></td>
</tr>
<tr>
<td>clave_acceso</td>
<td>string</td>
<td>La clave de acceso representa un identificador único del comprobante. Si esta información no es provista, Dátil la generará.<br>¿Cómo <a href="#clave-de-acceso">generar</a> la clave de acceso?</td>
</tr>
<tr>
<td>tipo_emision</td>
<td>integer</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='emisor'>Emisor</h3>
<p>Obtiene información del vendedor en la factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_seller</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='comprador'>Comprador</h3>
<p>Obtiene información del comprador en la factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_buyer</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">telefono</span>
  <span class="k">FROM</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono</td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
</tbody></table>
<h3 id='totales'>Totales</h3>
<p>Obtiene información de los valores totales de la facturas</p>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_totals</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">total_sin_impuestos</span><span class="p">,</span>
  <span class="n">importe_total</span><span class="p">,</span>
  <span class="n">propina</span><span class="p">,</span>
  <span class="n">descuento</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>total_sin_impuestos</td>
<td>float</td>
<td>Total antes de los impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>importe_total</td>
<td>float</td>
<td>Total incluyendo impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>propina</td>
<td>float</td>
<td>Propina total, llamado también servicio. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>Suma de los descuentos de cada ítem y del descuento adicional. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-totales'>Impuestos de totales</h3>
<p>Obtiene información de los impuestos de los totales de la factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_totals_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">totales_impuestos</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='items'>Items</h3>
<p>Obtiene todos los items de una factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">items</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_detalle</span><span class="p">,</span>
  <span class="n">codigo_principal</span><span class="p">,</span>
  <span class="n">codigo_auxiliar</span><span class="p">,</span>
  <span class="n">descripcion</span><span class="p">,</span>
  <span class="n">cantidad</span><span class="p">,</span>
  <span class="n">precio_unitario</span><span class="p">,</span>
  <span class="n">descuento</span><span class="p">,</span>
  <span class="n">precio_total_sin_impuestos</span><span class="p">,</span>
  <span class="n">unidad_medida</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">items</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td>string</td>
<td>Identifica de manera única el ítem o detalle de la factura. Si no hay un solo campo que lo identifique de manera única se debe usar la concatenación de varios.<strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_principal</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_auxiliar</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>descripcion</td>
<td>string</td>
<td>Descripción del ítem. <strong>Requerido</strong></td>
</tr>
<tr>
<td>cantidad</td>
<td>float</td>
<td>Cantidad de items. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_unitario</td>
<td>float</td>
<td>Precio unitario. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>El descuento es aplicado por cada producto. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_total_sin_impuestos</td>
<td>float</td>
<td>Precio antes de los impuestos. Se obtiene multiplicando la <code>cantidad</code> por el <code>precio_unitario</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>unidad_medida</td>
<td>string</td>
<td>Unidad de medida. Ejemplo: Kilos. <strong>Requerido para facturas de exportación</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-items'>Impuestos de items</h3>
<p>Obtiene los impuestos de un item. Este query es <strong>opcional</strong></p>
<pre class="highlight sql tab-sql"><code><span class="n">item_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">items_impuestos</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>float</td>
<td>Porcentaje actual del impuesto expresado por un número entre 0.0 y 100.0 <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem. Este query es <strong>opcional</strong>.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">nombre</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>   <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">items_detalles_adicionales</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional'>Información adicional</h3>
<p>Obtiene la información adicional de la factura. Este query es <strong>opcional</strong></p>

<p>La información adicional de la factura se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la factura:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">informacion_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la factura</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la factura</td>
</tr>
</tbody></table>
<h3 id='pagos'>Pagos</h3>
<p>Obtiene la información de los pagos aplicables a la factura.</p>
<pre class="highlight sql tab-sql"><code><span class="n">payment_methods</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_pago</span><span class="p">,</span>
  <span class="n">medio_pago</span> <span class="n">medio</span><span class="p">,</span>
  <span class="n">total_pago</span> <span class="n">total</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">pagos</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_pago</td>
<td>--</td>
<td>Identificador único del pago, se usa para obtener las [propiedades</td>
</tr>
</tbody></table>

<p>del pago](Propiedades de Pagos), si no hay un identificador único del pago o no hay propiedades de pagos, se debe devolver el <em>id_factura</em>.
medio              | string                  | Código del <a href="#tipos-de-forma-de-pago">tipo de forma de pago</a>. <strong>Requerido</strong>
total               | float                   | Total aplicable a la forma de pago especificada. <strong>Requerido</strong></p>
<h3 id='propiedades-de-pagos'>Propiedades de Pagos</h3>
<p>Obtiene la propiedades de los pagos de determinada factura. Este query es <strong>opcional</strong></p>

<p>Las propiedades de los pagos se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Plazo&#39;:&#39;5&#39;</p>

<p>Se asume que en la tabla consultada una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con propiedades de los pagos:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>plazo</td>
<td>9</td>
</tr>
<tr>
<td>unidad_tiempo</td>
<td>dias</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">payment_method_properties</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">propiedades_pagos</span>
  <span class="k">WHERE</span>
  <span class="n">id_pago</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la propiedad del pago</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la propiedad del pago</td>
</tr>
</tbody></table>

<p>Para el Servicio de Rentas Internas de Ecuador (SRI), las únicas propiedades que se tomarán en cuenta son <code>plazo</code> (especifica el plazo del tipo de pago) y <code>unidad_tiempo</code> (especifica la unidad de tiempo en la cual se expresa el plazo).</p>

<p>Las demás propiedades que se especifiquen se registrarán en Dátil como parte del pago, pero no se reportarán al SRI.</p>
<h3 id='credito'>Crédito</h3>
<p>Crédito otorgado en la venta.  Este query es <strong>opcional</strong> , en caso de que todos los pagos se realizan en el momento de la venta, es decir no hay crédito.</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>fecha_vencimiento</td>
<td>string</td>
<td>Fecha de vencimiento en formato AAAA-MM-DD, definido en el estándar <a href="http://tools.ietf.org/html/rfc3339#section-5.6">ISO8601</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>monto</td>
<td>float</td>
<td>Monto otorgado de crédito. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_credit</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">monto</span><span class="p">,</span>
  <span class="n">fecha_vencimiento</span>
  <span class="k">FROM</span>
  <span class="n">facturas</span><span class="p">.</span><span class="n">credito</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre><h3 id='compensacion-solidaria'>Compensación solidaria</h3>
<p>Descuento otorgado a las provincias de Manabí y Esmeraldas. Obligatorio solo para estas provincias.</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>int</td>
<td>Código del porcentaje de IVA . <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>int</td>
<td>Porcentaje de compensación. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor de la compensación. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_compensation</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">facturas</span><span class="p">.</span><span class="n">compensacion</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre><h3 id='exportacion'>Exportación</h3>
<p>Obligatorio <strong>solo</strong> para facturas de exportación</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>incoterm_termino</td>
<td>string</td>
<td>Código de 3 letras correspondiente al <a href="https://en.wikipedia.org/wiki/Incoterms#Rules_for_any_mode_of_transport">Incoterm</a> . <strong>Requerido</strong></td>
</tr>
<tr>
<td>incoterm_lugar</td>
<td>string</td>
<td>Lugar Incoterm . <strong>Requerido</strong></td>
</tr>
<tr>
<td>incoterm_total_sin_impuestos</td>
<td>string</td>
<td>Total sin impuestos pagado por el incoterm. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_pais_origen</td>
<td>string</td>
<td>Código de dos letras del país origen según <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements">ISO_3166</a>  . <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_pais_destino</td>
<td>string</td>
<td>Código de dos letras del país origen según <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements">ISO_3166</a></td>
</tr>
<tr>
<td>codigo_pais_adquisicion</td>
<td>string</td>
<td>Código de dos letras del país origen según<a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements">ISO_3166</a></td>
</tr>
<tr>
<td>puerto_origen</td>
<td>string</td>
<td>Puerto de origen. <strong>Requerido</strong></td>
</tr>
<tr>
<td>puerto_destino</td>
<td>string</td>
<td>Puerto de destino. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total_flete_internacional</td>
<td>float</td>
<td>Total del flete internacional</td>
</tr>
<tr>
<td>total_seguro_internacional</td>
<td>float</td>
<td>Total del seguro internacional</td>
</tr>
<tr>
<td>total_gastos_aduaneros</td>
<td>float</td>
<td>Total de los gastos aduaneros</td>
</tr>
<tr>
<td>total_otros_gastos_transporte</td>
<td>float</td>
<td>Total de otros gastos de transporte</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_export</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">incoterm_termino</span><span class="p">,</span>
  <span class="n">incoterm_lugar</span><span class="p">,</span>
  <span class="n">incoterm_total_sin_impuestos</span><span class="p">,</span>
  <span class="n">codigo_pais_origen</span><span class="p">,</span>
  <span class="n">codigo_pais_destino</span><span class="p">,</span>
  <span class="n">codigo_pais_adquisicion</span><span class="p">,</span>
  <span class="n">puerto_origen</span><span class="p">,</span>
  <span class="n">puerto_destino</span><span class="p">,</span>
  <span class="n">total_flete_internacional</span><span class="p">,</span>
  <span class="n">total_seguro_internacional</span><span class="p">,</span>
  <span class="n">total_gastos_aduaneros</span><span class="p">,</span>
  <span class="n">total_otros_gastos_transporte</span><span class="p">,</span>
  <span class="k">FROM</span>
  <span class="n">facturas</span><span class="p">.</span><span class="n">exportacion</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre><h3 id='tablas-recomendadas'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de la factura.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">facturas</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago_propiedad</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">]</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- (OPCIONAL) el ambiente se toma del archivo de configuración de Link App.</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">moneda</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">15</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- USD para dólares</span>
    <span class="p">[</span><span class="n">guia_remision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">17</span><span class="p">),</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">49</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_matriz</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- COMPRADOR</span>
    <span class="p">[</span><span class="n">email_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- TOTALES</span>
    <span class="p">[</span><span class="n">total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">importe_total</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">propina</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento_adicional</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- CREDITO</span>
    <span class="p">[</span><span class="n">monto_credito</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_vencimiento_credito</span><span class="p">]</span> <span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- VALORES RETENIDOS</span>
    <span class="p">[</span><span class="n">valor_retenido_iva</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor_retenido_renta</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">cantidad</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_principal</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_auxiliar</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_unitario</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descripcion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">unidad_medida</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span>

<span class="p">)</span>

<span class="c1">-- FACTURA: IMPUESTOS DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- porcentaje</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_item_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: DETALLES ADICIONALES DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_items_detalles_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: IMPUESTOS TOTALES</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_total_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_factura</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: INFORMACION ADICIONAL DE LA FACTURA</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_informacion_adicional</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_factura</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: PAGOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">fecha</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">medio</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">notas</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="k">max</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">monto</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: PROPIEDADES DE PAGOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago_propiedad</span><span class="p">](</span>
  <span class="p">[</span><span class="n">id_pago</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
  <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">PK_pago_propiedad</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_pago</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: CREDITO</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">credito</span><span class="p">](</span>
  <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
  <span class="p">[</span><span class="n">monto</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="p">[</span><span class="n">fecha_vencimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: COMPENSACION SOLIDARIA</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">compensacion</span><span class="p">](</span>
  <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
  <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: EXPORTACION</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">exportacion</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">incoterm_termino</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">incoterm_lugar</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">incoterm_total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_pais_origen</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_pais_destino</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_pais_adquisicion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">puerto_origen</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">puerto_destino</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_flete_internacional</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_seguro_internacional</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_gastos_aduaneros</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_otros_gastos_transporte</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>
</code></pre><h2 id='notas-de-credito'>Notas de crédito</h2>
<p>Los queries para la emisión electrónica de <strong>notas de crédito</strong> se guardan en el archivo de configuración <code>credit_note.ini</code>.</p>

<p><a href="/link-app#credit_note-ini">Ejemplo de archivo credit_note.ini</a></p>
<h3 id='cabecera-2'>Cabecera</h3>
<p>Obtiene información de la cabecera de la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_nota_credito</span>             <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_emision</span><span class="p">,</span>
  <span class="n">moneda</span><span class="p">,</span>
  <span class="n">clave_acceso</span><span class="p">,</span>
  <span class="n">tipo_emision</span><span class="p">,</span>
  <span class="n">fecha_emision_documento_modificado</span><span class="p">,</span>
  <span class="n">numero_documento_modificado</span><span class="p">,</span>
  <span class="n">tipo_documento_modificado</span><span class="p">,</span>
  <span class="n">motivo</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id_nota_credito</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la nota de crédito. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la nota de crédito. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision</td>
<td>datetime</td>
<td>Fecha de emisión   <strong>Requerido</strong></td>
</tr>
<tr>
<td>moneda</td>
<td>string</td>
<td>Código <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO</a> de la moneda. <strong>Requerido</strong></td>
</tr>
<tr>
<td>clave_acceso</td>
<td>string</td>
<td>La clave de acceso representa un identificador único del comprobante. Si esta información no es provista, Dátil la generará.<br>¿Cómo <a href="#clave-de-acceso">generar</a> la clave de acceso?</td>
</tr>
<tr>
<td>tipo_emision</td>
<td>integer</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision_documento_modificado</td>
<td>datetime</td>
<td>Fecha de emisión en formato AAAA-MM-DDHoraZonaHoraria del documento modificado, definido en el estándar <a href="http://tools.ietf.org/html/rfc3339#section-5.6">ISO8601</a>.  <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_documento_modificado</td>
<td>string</td>
<td>Número completo del documento que se está afectando. Normalmente facturas. Ejm: 001-002-010023098 <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_documento_modificado</td>
<td>string</td>
<td>Códigos de <a href="#tipos-de-documentos">tipos de documentos</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>motivo</td>
<td>string</td>
<td>Motivo de la operación. Ejm: Devolución de producto. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='vendedor'>Vendedor</h3>
<p>Obtiene información del vendedor en la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_seller</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='comprador-2'>Comprador</h3>
<p>Obtiene información del comprador en la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_buyer</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">telefono</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono</td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
</tbody></table>
<h3 id='totales-2'>Totales</h3>
<p>Obtiene información de los valores totales de la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_totals</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">total_sin_impuestos</span><span class="p">,</span>
  <span class="n">importe_total</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>total_sin_impuestos</td>
<td>float</td>
<td>Total antes de los impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>importe_total</td>
<td>float</td>
<td>Total incluyendo impuestos. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-totales-2'>Impuestos de totales</h3>
<p>Obtiene información de los impuestos de los totales de la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_totals_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">totales_impuestos</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='items-2'>Items</h3>
<p>Obtiene todos los items de una nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">items</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_detalle</span><span class="p">,</span>
  <span class="n">codigo_principal</span><span class="p">,</span>
  <span class="n">codigo_auxiliar</span><span class="p">,</span>
  <span class="n">descripcion</span><span class="p">,</span>
  <span class="n">cantidad</span><span class="p">,</span>
  <span class="n">precio_unitario</span><span class="p">,</span>
  <span class="n">descuento</span><span class="p">,</span>
  <span class="n">precio_total_sin_impuestos</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">items</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td>string</td>
<td>Identifica de manera única el ítem o detalle de la nota de crédito. Si no hay un solo campo que lo identifique de manera única se debe usar la concatenación de varios.<strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_principal</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_auxiliar</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>descripcion</td>
<td>string</td>
<td>Descripción del ítem. <strong>Requerido</strong></td>
</tr>
<tr>
<td>cantidad</td>
<td>float</td>
<td>Cantidad de items. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_unitario</td>
<td>float</td>
<td>Precio unitario. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>El descuento es aplicado por cada producto. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_total_sin_impuestos</td>
<td>float</td>
<td>Precio antes de los impuestos. Se obtiene multiplicando la <code>cantidad</code> por el <code>precio_unitario</code> <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-items-2'>Impuestos de items</h3>
<p>Obtiene los impuestos de un item</p>
<pre class="highlight sql tab-sql"><code><span class="n">item_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">items_impuestos</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>float</td>
<td>Porcentaje actual del impuesto expresado por un número entre 0.0 y 100.0 <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items-2'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem. Este query es opcional.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>   <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">items_detalles_adicionales</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional-2'>Información adicional</h3>
<p>Obtiene la información adicional de la nota de crédito.</p>

<p>La información adicional de la nota de crédito se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la nota de crédito:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">informacion_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la nota de crédito</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la nota de crédito</td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items-3'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem. Este query es opcional.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>   <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">items_detalles_adicionales</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='tablas-recomendadas-2'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de la nota de crédito.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code>
<span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">notas_de_credito</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">]</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">moneda</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">15</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">49</span><span class="p">),</span>
    <span class="c1">-- DOCUMENTO MODIFICADO</span>
    <span class="p">[</span><span class="n">fecha_emision_documento_modificado</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">17</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_documento_modificado</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">motivo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_matriz</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- COMPRADOR</span>
    <span class="p">[</span><span class="n">email_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- TOTALES</span>
    <span class="p">[</span><span class="n">total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">importe_total</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_nota_credito</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">cantidad</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_principal</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_auxiliar</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_unitario</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descripcion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: IMPUESTOS DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- porcentaje</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_item_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: DETALLES ADICIONALES DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_items_detalles_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: IMPUESTOS TOTALES</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_nota_credito</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_total_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_nota_credito</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: INFORMACION ADICIONAL DE LA NOTA DE CRÉDITO</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_nota_credito</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_informacion_adicional</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_nota_credito</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

</code></pre><h2 id='comprobantes-de-retencion'>Comprobantes de Retención</h2>
<p>Los queries para la emisión electrónica de <strong>retención</strong> se guardan en el archivo de configuración <code>retention.ini</code>.</p>

<p><a href="/link-app#retention-ini">Ejemplo de archivo retention.ini</a></p>
<h3 id='cabecera-3'>Cabecera</h3>
<p>Obtiene información de la cabecera de la retención</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_nota_credito</span>             <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_emision</span><span class="p">,</span>
  <span class="n">clave_acceso</span><span class="p">,</span>
  <span class="n">tipo_emision</span><span class="p">,</span>
  <span class="n">periodo_fiscal</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id_retencion</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la retención. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la retención. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision</td>
<td>datetime</td>
<td>Fecha de emisión   <strong>Requerido</strong></td>
</tr>
<tr>
<td>clave_acceso</td>
<td>string</td>
<td>La clave de acceso representa un identificador único del comprobante. Si esta información no es provista, Dátil la generará.<br>¿Cómo <a href="#clave-de-acceso">generar</a> la clave de acceso?</td>
</tr>
<tr>
<td>tipo_emision</td>
<td>integer</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
<tr>
<td>periodo_fiscal</td>
<td>string</td>
<td>Mes y año en el siguiente formato MM/AAAA. Ejm: 12/2015 <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='vendedor-2'>Vendedor</h3>
<p>Obtiene información del vendedor en la retención</p>
<pre class="highlight sql tab-sql"><code><span class="n">retention_seller</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='sujeto-retenido'>Sujeto retenido</h3>
<p>Obtiene información del sujeto retenido en la retención</p>
<pre class="highlight sql tab-sql"><code><span class="n">retention_recipient</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">telefono</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono</td>
</tr>
</tbody></table>
<h3 id='impuestos-de-la-retencion'>Impuestos de la retención</h3>
<p>Obtiene información de los impuestos de la retención</p>
<pre class="highlight sql tab-sql"><code><span class="n">retention_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
    <span class="n">codigo</span><span class="p">,</span>
    <span class="n">codigo_porcentaje</span><span class="p">,</span>
    <span class="n">porcentaje</span><span class="p">,</span>
    <span class="n">base_imponible</span><span class="p">,</span>
    <span class="n">valor_retenido</span><span class="p">,</span>
    <span class="n">tipo_documento_sustento</span><span class="p">,</span>
    <span class="n">numero_documento_sustento</span><span class="p">,</span>
    <span class="n">fecha_emision_documento_sustento</span>
    <span class="k">FROM</span>
    <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">impuesto</span>
    <span class="k">WHERE</span>
    <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código de <a href="#tipos-de-impuesto-para-la-retencion">tipo de impuesto</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td><a href="#retencion-de-iva">Código del porcentaje</a> a aplicar dentro del tipo de impuesto <strong>Requerido</strong></td>
</tr>
<tr>
<td>porcentaje</td>
<td>string</td>
<td>Porcentaje a retener <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor_retenido</td>
<td>float</td>
<td>Valor retenido. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_documento_sustento</td>
<td>string</td>
<td>Códigos de <a href="#tipos-de-documentos">tipos de documentos</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_documento_sustento</td>
<td>string</td>
<td>Número completo del documento que se está afectando. Normalmente facturas. Ejm: 001-002-010023098 <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision_documento_sustento</td>
<td>datetime</td>
<td>Fecha de emisión del documento sustento de la retención_<em>Requerido</em>_</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional-3'>Información adicional</h3>
<p>Obtiene la información adicional de la retención.</p>

<p>La información adicional de la retención se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la retención:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">retention_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">informacion_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la rentención</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la retención</td>
</tr>
</tbody></table>
<h3 id='tablas-recomendadas-3'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de la retención.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code>
<span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">retenciones</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">item</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">retencion</span><span class="p">]</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">retencion</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">49</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">periodo_fiscal</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">7</span><span class="p">),</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_matriz</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- SUJETO RETENIDO</span>
    <span class="p">[</span><span class="n">email_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- RETENCION: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_retencion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">retencion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">5</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">17</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor_retenido</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- RETENCION: INFORMACION ADICIONAL DE LA RETENCION</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_retencion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">retencion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_informacion_adicional</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_retencion</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

</code></pre><h2 id='guias-de-remision'>Guías de Remisión</h2>
<p>Los queries para la emisión electrónica de <strong>guías de remisión</strong> se guardan en el archivo de configuración <code>waybill.ini</code>.</p>

<p><a href="/link-app#waybill-ini">Ejemplo de archivo waybill.ini</a></p>
<h3 id='cabecera-4'>Cabecera</h3>
<p>Obtiene información de la cabecera de la guía de remisión</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_guia_remision</span>             <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_inicio_transporte</span><span class="p">,</span>
  <span class="n">fecha_fin_transporte</span><span class="p">,</span>
  <span class="n">direccion_partida</span><span class="p">,</span>
  <span class="n">clave_acceso</span><span class="p">,</span>
  <span class="n">tipo_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_guia_remision</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id_guia_remision</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la guía de remisión. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la retención. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_inicio_transporte</td>
<td>datetime</td>
<td>Fecha en la que inicia el transporte dada la guía de remisión <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_fin_transporte</td>
<td>datetime</td>
<td>Fecha en la que termina el transporte dada la guía de remisión <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_partida</td>
<td>string</td>
<td>Dirección de partida</td>
</tr>
<tr>
<td>clave_acceso</td>
<td>string</td>
<td>La clave de acceso representa un identificador único del comprobante. Si esta información no es provista, Dátil la generará.<br>¿Cómo <a href="#clave-de-acceso">generar</a> la clave de acceso?</td>
</tr>
<tr>
<td>tipo_emision</td>
<td>integer</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='vendedor-3'>Vendedor</h3>
<p>Obtiene información del vendedor en la guía de remisión</p>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_seller</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_guia_remision</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='transportista'>Transportista</h3>
<p>Obtiene información del transportista en la guía de remisión</p>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_shipper</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">telefono</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_guia_remision</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono</td>
</tr>
</tbody></table>
<h3 id='destinatarios'>Destinatarios</h3>
<p>Obtiene información de los destinatarios en la guía de remisión</p>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_receivers</span>  <span class="o">=</span> <span class="k">SELECT</span>
    <span class="n">id_destinatario</span>     <span class="n">receiver_id</span><span class="p">,</span>
    <span class="n">razon_social</span><span class="p">,</span>
    <span class="n">identificacion</span><span class="p">,</span>
    <span class="n">tipo_identificacion</span><span class="p">,</span>
    <span class="n">email</span><span class="p">,</span>
    <span class="n">telefono</span><span class="p">,</span>
    <span class="n">direccion</span><span class="p">,</span>
    <span class="n">ruta</span><span class="p">,</span>
    <span class="n">documento_aduanero_unico</span><span class="p">,</span>
    <span class="n">codigo_establecimiento_destino</span><span class="p">,</span>
    <span class="n">fecha_emision_documento_sustento</span><span class="p">,</span>
    <span class="n">numero_documento_sustento</span><span class="p">,</span>
    <span class="n">tipo_documento_sustento</span><span class="p">,</span>
    <span class="n">motivo_traslado</span><span class="p">,</span>
    <span class="n">numero_autorizacion_documento_sustento</span>
    <span class="k">FROM</span>
    <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">destinatario</span>
    <span class="k">WHERE</span>
    <span class="n">id_guia_remision</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>receiver_id</td>
<td>string</td>
<td>Identifica de manera única al destinatario en la guía de remisión. <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social del destinatario. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico del destinatario. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono del destinatario</td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección del destinatario</td>
</tr>
<tr>
<td>ruta</td>
<td>string</td>
<td>Ruta de transporte. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>documento_aduanero_unico</td>
<td>string</td>
<td>Máximo 20 caracteres.</td>
</tr>
<tr>
<td>fecha_emision_documento_sustento</td>
<td>datetime</td>
<td>Fecha de emisión del documento sustento de la guía de remisión, usualmente una factura.  <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_documento_sustento</td>
<td>string</td>
<td>Número completo del documento que detalla la mercadería a transportar. Normalmente facturas. Ejm: 001-002-010023098</td>
</tr>
<tr>
<td>codigo_establecimiento_destino</td>
<td>string</td>
<td>Número establecimiento que recibe la entrega.  <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_documento_sustento</td>
<td>string</td>
<td>Número completo del documento que detalla la mercadería a transportar. Normalmente facturas. Ejm: 001-002-010023098 <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_documento_sustento</td>
<td>string</td>
<td>tipo_documento_sustento</td>
</tr>
<tr>
<td>motivo_traslado</td>
<td>string</td>
<td>Motivo del traslado. Ejm: Entrega de mercadería. <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_autorizacion_documento_sustento</td>
<td>string</td>
<td>Autorización del documento de sustento.</td>
</tr>
</tbody></table>
<h3 id='items-del-destinatario'>Items del destinatario</h3>
<p>Obtiene la información de los items que recibirá el destinatario</p>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_receiver_items</span> <span class="o">=</span> <span class="k">SELECT</span>
    <span class="n">id_detalle</span><span class="p">,</span>
    <span class="n">descripcion</span><span class="p">,</span>
    <span class="n">codigo_principal</span><span class="p">,</span>
    <span class="n">codigo_auxiliar</span><span class="p">,</span>
    <span class="n">cantidad</span>
    <span class="k">FROM</span>
    <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">detalle</span>
    <span class="k">WHERE</span>
    <span class="n">id_destinatario</span> <span class="o">=</span> <span class="o">?</span>

</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td>string</td>
<td>Identifica de manera única el ítem o detalle de la factura. Si no hay un solo campo que lo identifique de manera única se debe usar la concatenación de varios.<strong>Requerido</strong></td>
</tr>
<tr>
<td>descripcion</td>
<td>string</td>
<td>Descripción del ítem. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_principal</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_auxiliar</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>cantidad</td>
<td>float</td>
<td>Cantidad de items. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items-4'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem. Este query es opcional.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>   <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">items_detalles_adicionales</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional-4'>Información adicional</h3>
<p>Obtiene la información adicional de la guía de remisión.</p>

<p>La información adicional de la guía de remisión se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la guía de remisión:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">informacion_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la rentención</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la retención</td>
</tr>
</tbody></table>
<h3 id='tablas-recomendadas-4'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de la guía de remisión.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">guias_de_remision</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">guia_remision</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">destinatario</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">]</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">guia_remision</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_inicio_transporte</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_fin_transporte</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_partida</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">49</span><span class="p">),</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- TRANSPORTISTA</span>
    <span class="p">[</span><span class="n">email_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">placa</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- GUIA DE REMISION: DESTINATARIOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">destinatario</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_destinatario</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">guia_remision</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">email</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">17</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_autorizacion_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ruta</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">motivo_traslado</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">documento_aduanero_unico</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento_destino</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- GUIA DE REMISION: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_destinatario</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">destinatario</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">cantidad</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_principal</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_auxiliar</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descripcion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- GUIA DE REMISION: DETALLES ADICIONALES DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_items_detalles_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- GUIA DE REMISION: INFORMACION ADICIONAL DE LA GUIA DE REMISION</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_guia_remision</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">guia_remision</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_informacion_adicional</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_guia_remision</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

</code></pre><h2 id='liquidaciones-de-compra'>Liquidaciones de compra</h2>
<p>Los queries para la emisión electrónica de <strong>liquidaciones de compra</strong> se guardan en el archivo de configuración <code>purchase_settlement.ini</code>.</p>

<p><a href="/link-app#purchase_settlement-ini">Ejemplo de archivo purchase_settlement.ini</a></p>
<h3 id='cabecera-5'>Cabecera</h3>
<p>Obtiene información de la cabecera de la liquidación de compra</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id</span>                      <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_emision</span><span class="p">,</span>
  <span class="n">moneda</span><span class="p">,</span>
  <span class="n">tipo_emision</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la liquidación de compra. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la liquidación. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision</td>
<td>datetime</td>
<td>Fecha en la que se emite la liquidación.</td>
</tr>
<tr>
<td>moneda</td>
<td>string</td>
<td>Código <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO</a> de la moneda. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_emision</td>
<td>int</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='emisor-2'>Emisor</h3>
<p>Obitiene información del emisor de la liquidación de compra</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_buyer</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_matriz</span>              <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo_establecimiento</span>        <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td></td>
<td></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='proveedor'>Proveedor</h3>
<p>Obtiene información del proveedor de la liquidación de compra</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_provider</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificador_proveedor</span>                   <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificador_proveedor</span>              <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social_proveedor</span> <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_proveedor</span> <span class="n">direccion</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
</tbody></table>
<h3 id='totales-3'>Totales</h3>
<p>Obtiene información de los valores totales de las liquidaciones</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_totals</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">total_sin_impuestos</span><span class="p">,</span>
  <span class="n">importe_total</span><span class="p">,</span>
  <span class="n">descuento</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>total_sin_impuestos</td>
<td>float</td>
<td>Total antes de los impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>importe_total</td>
<td>float</td>
<td>Total incluyendo impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>Suma de los descuentos de cada ítem y del descuento adicional. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-totales-3'>Impuestos de totales</h3>
<p>Obtiene información de los impuestos de los totales de la factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_totals_taxes</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span>
  <span class="k">FROM</span> 
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">total_impuesto</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='items-3'>Items</h3>
<p>Obtiene todos los items de una factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">items</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id</span> <span class="n">id_detalle</span><span class="p">,</span>
  <span class="n">codigo_principal</span><span class="p">,</span>
  <span class="n">codigo_auxiliar</span><span class="p">,</span>
  <span class="n">descripcion</span><span class="p">,</span>
  <span class="n">cantidad</span><span class="p">,</span>
  <span class="n">unidad_medida</span><span class="p">,</span>
  <span class="n">precio_unitario</span><span class="p">,</span>
  <span class="n">descuento</span><span class="p">,</span>
  <span class="n">precio_total_sin_impuestos</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">item</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td>int</td>
<td>Identifica de manera única el ítem o detalle de la factura. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_principal</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_auxiliar</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>descripcion</td>
<td>string</td>
<td>Descripción del ítem. <strong>Requerido</strong></td>
</tr>
<tr>
<td>cantidad</td>
<td>float</td>
<td>Cantidad de items. <strong>Requerido</strong></td>
</tr>
<tr>
<td>unidad_medida</td>
<td>string</td>
<td>Unidad de medida. Ejemplo: Kilos.</td>
</tr>
<tr>
<td>precio_unitario</td>
<td>float</td>
<td>Precio unitario. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>El descuento es aplicado por cada producto.</td>
</tr>
<tr>
<td>precio_total_sin_impuestos</td>
<td>float</td>
<td>Precio antes de los impuestos. Se obtiene multiplicando la <code>cantidad</code> por el <code>precio_unitario</code> <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-items-3'>Impuestos de items</h3>
<p>Obtiene los impuestos de un item.</p>
<pre class="highlight sql tab-sql"><code><span class="n">item_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_item</span> <span class="n">id_detalle</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">item_impuesto</span>
  <span class="k">WHERE</span>
  <span class="n">id_item</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td></td>
<td></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>float</td>
<td>Porcentaje actual del impuesto expresado por un número entre 0.0 y 100.0 <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items-5'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">nombre</span>    <span class="n">nombre</span><span class="p">,</span>
  <span class="n">valor</span>   <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">item_detalle_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_item</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional-5'>Información adicional</h3>
<p>Obtiene la información adicional de la factura. Este query es <strong>opcional</strong></p>

<p>La información adicional de la factura se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la liquidación:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">nombre</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">valor</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">info_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la factura</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la factura</td>
</tr>
</tbody></table>
<h3 id='pagos-2'>Pagos</h3>
<p>Obtiene la información de los pagos aplicables a la liquidación.</p>
<pre class="highlight sql tab-sql"><code><span class="n">payment_methods</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">forma_pago</span><span class="p">,</span>
  <span class="n">total</span> <span class="n">total</span><span class="p">,</span>
  <span class="n">unidad_tiempo</span><span class="p">,</span>
  <span class="n">plazo</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">pago</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>forma_pago</td>
<td>string</td>
<td>Código del <a href="#tipos-de-forma-de-pago">tipo de forma de pago</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total</td>
<td>float</td>
<td>Total aplicable a la forma de pago especificada. <strong>Requerido</strong></td>
</tr>
<tr>
<td>unidad_tiempo</td>
<td>string</td>
<td>Especifica la unidad de tiempo en la cual se expresa el plazo.</td>
</tr>
<tr>
<td>plazo</td>
<td>int</td>
<td>Especifica el plazo del tipo de pago.</td>
</tr>
</tbody></table>
<h3 id='reembolsos'>Reembolsos</h3>
<p>Obtiene el reembolso aplicable a una liquidación.</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_reimbursement</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">r</span><span class="p">.</span><span class="n">id_reembolso</span><span class="p">,</span>
  <span class="n">l</span><span class="p">.</span><span class="n">codigo_documento_reembolso</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span> <span class="k">AS</span> <span class="n">l</span> <span class="k">JOIN</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">reembolso</span> <span class="k">AS</span> <span class="n">r</span> 
  <span class="k">ON</span>
  <span class="n">l</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">id_liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>r.id_reembolso</td>
<td>int</td>
<td>Identificador del reembolso. <strong>Reembolso</strong></td>
</tr>
<tr>
<td>l.codigo_documento_reembolso</td>
<td>Identificador del documento de reembolso. <strong>Reembolso</strong></td>
<td></td>
</tr>
</tbody></table>
<h3 id='totales-de-reembolosos'>Totales de reembolosos</h3>
<p>Obtiene la información de los totales de un reembolso</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_reimbursement_totals</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">total_comprobante_reembolso</span>            <span class="n">subtotal</span><span class="p">,</span>
  <span class="n">total_base_imponible_reembolso</span>         <span class="n">total</span><span class="p">,</span>
  <span class="n">total_impuesto_reembolso</span>               <span class="n">total_impuestos</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>subtotal</td>
<td>float</td>
<td>Total del reembolso incluyendo base imponible e impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total</td>
<td>float</td>
<td>Total del reembolso incluyendo la base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total_impuestos</td>
<td>float</td>
<td>Total del reembolso incluyendo los impuestos</td>
</tr>
</tbody></table>
<h3 id='documennto-reembolso'>Documennto reembolso</h3>
<p>Obtiene la información de un reembolso.</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_reimbursement_document</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo_documento_reembolso</span>            <span class="n">codigo</span><span class="p">,</span>
  <span class="n">id_reembolso</span>                          <span class="n">id_documento</span><span class="p">,</span>
  <span class="n">id_proveedor_reembolso</span><span class="p">,</span>
  <span class="n">tipo_id_proveedor_reembolso</span><span class="p">,</span>
  <span class="n">codigo_pais_pago_proveedor_reembolso</span><span class="p">,</span>
  <span class="n">tipo_proveedor_reembolso</span><span class="p">,</span>
  <span class="n">secuencia_reembolso</span><span class="p">,</span>
  <span class="n">punto_emision_reembolso</span><span class="p">,</span>
  <span class="n">fecha_emision_reembolso</span><span class="p">,</span>
  <span class="n">numero_autorizacion_reembolso</span><span class="p">,</span>
  <span class="n">codigo_establecimiento_reembolso</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">reembolso</span>
  <span class="k">WHERE</span>
  <span class="n">id_reembolso</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 2 caracteres que representa al documento de reembolso. Ejemplo: <code>01</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>id_documento</td>
<td>int</td>
<td>Identifica de manera única al documento de reemoblso. <strong>Requerido</strong></td>
</tr>
<tr>
<td>id_proveedor_reembolso</td>
<td>string</td>
<td>Identifica de manera única al proveedor en la liquidación. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_id_proveedor_reembolso</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_pais_pago_proveedor_reembolso</td>
<td>string</td>
<td>Código de dos letras del país del proveedor según [ISO_3166](https://en.wikipedia.org/wiki/ <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_proveedor_reembolso</td>
<td>string</td>
<td>Tipo de proveedor <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencia_reembolso</td>
<td>int</td>
<td>Número de secuencia de la factura. <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision_reembolso</td>
<td>string</td>
<td>Código numérico de 3 caracteres que  representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision_reembolso</td>
<td>datetime</td>
<td>Fecha de emisión <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_autorizacion_reembolso</td>
<td>string</td>
<td>Autorización del documento de reembolso. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_establecimiento_reembolso</td>
<td>float</td>
<td>Número establecimiento que recibe la entrega. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-reembolsos'>Impuestos de reembolsos</h3>
<p>Obtiene información de los impuestos de los reembolsos</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_reimbursement_tax</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">impuesto_reembolso</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">reembolso_tax</span>
  <span class="k">WHERE</span>
  <span class="n">id_reembolso</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>float</td>
<td>Porcentaje actual del impuesto expresado por un número entre 0.0 y 100.0 <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>impuesto_reembolso</td>
<td>float</td>
<td>Valor del impuesto del reembolso</td>
</tr>
</tbody></table>
<h3 id='maquina-fiscal'>Máquina fiscal</h3>
<p>Obtiene información de la máquina fiscal con la que se emitió la liquidación</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_fiscal_machine</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">marca</span><span class="p">,</span>
  <span class="n">modelo</span><span class="p">,</span>
  <span class="n">serie</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">maquina_fiscal</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>marca</td>
<td>string</td>
<td>Marca de máximo 100 caracteres</td>
</tr>
<tr>
<td>modelo</td>
<td>string</td>
<td>Modelo de máximo 100 caracteres</td>
</tr>
<tr>
<td>serie</td>
<td>string</td>
<td>Serie de máximo 100 caracteres</td>
</tr>
</tbody></table>
<h3 id='tablas-recomendadas-5'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de las liquidaciones de compra.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">liquidaciones_compra</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">49</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">DATETIME</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">moneda</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">15</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_documento</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_matriz</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- PROVEEDOR</span>
    <span class="p">[</span><span class="n">tipo_identificador_proveedor</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_proveedor</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificador_proveedor</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_proveedor</span><span class="p">]</span> <span class="p">[</span><span class="n">vARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- TOTALES</span>
    <span class="p">[</span><span class="n">total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">importe_total</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- REEMBOLSO</span>
    <span class="p">[</span><span class="n">codigo_documento_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_comprobante_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_base_imponible_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_impuesto_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo_principal</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">25</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_auxiliar</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">25</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descripcion</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">unidad_medida</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">cantidad</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_unitario</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDIACION: DETALLES ADICIONALES DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_items_detalles_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: IMPUESTOS DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- porcentaje</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_item_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: IMPUESTOS TOTALES</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento_adicional</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_total_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_liquidacion</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDIACION: PAGOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">pago</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">forma_pago</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">plazo</span><span class="p">]</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">unidad_tiempo</span><span class="p">]</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: REEMBOLSOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">reembolso</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_reembolso</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">tipo_id_proveedor_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_proveedor_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_pais_pago_proveedor_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_proveedor_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_documento_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DATETIME</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_autorizacion_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">49</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: REEMBOLSO IMPUESTOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">reembolso_tax</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">reembolso</span><span class="p">](</span><span class="n">id_reembolso</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">impuesto_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: MAQUINA FISCAL</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">maquina_fiscal</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">marca</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">modelo</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_maquina_fiscal</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">marca</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: INFO ADICIONAL</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">info_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_info_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_liquidacion</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>
</code></pre><h1 id='clave-de-acceso'>Clave de acceso</h1>
<p>El sistema se encarga de generar automáticamente la clave de acceso de cada
comprobante y luego retornarla como parte de la respuesta de emisión del mismo.
Pero es posible también proveer la clave de acceso si se requiere tener control
en la generación de esta clave. La siguiente documentación explica como debe
estar estructurada la clave de acceso.</p>

<p>Las claves de acceso estarán compuestas de 49 caracteres numéricos, la herramienta o aplicativo a utilizar por el sujeto pasivo deberá generar de manera automática la clave de acceso, que constituirá un requisito que dará el carácter de único a cada uno de los comprobantes, y la misma servirá para que el SRI indique si el comprobante es autorizado o no; se describe a continuación su conformación:</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Formato</th>
<th>Longitud</th>
</tr>
</thead><tbody>
<tr>
<td>Fecha de Emisión</td>
<td>DDMMAAAA</td>
<td>8</td>
</tr>
<tr>
<td>Tipo de Comprobante</td>
<td>Tabla 4</td>
<td>2</td>
</tr>
<tr>
<td>Número de RUC</td>
<td>1234567890001</td>
<td>13</td>
</tr>
<tr>
<td>Tipo de Ambiente</td>
<td>Tabla 5</td>
<td>1</td>
</tr>
<tr>
<td>Serie</td>
<td>001001</td>
<td>6</td>
</tr>
<tr>
<td>Número del Comprobante (secuencial)</td>
<td>000000001</td>
<td>9</td>
</tr>
<tr>
<td>Código Numérico</td>
<td>Numérico</td>
<td>8</td>
</tr>
<tr>
<td>Tipo de Emisión</td>
<td>Tabla 2</td>
<td>1</td>
</tr>
<tr>
<td>Dígito Verificador (módulo 11 )</td>
<td>Numérico</td>
<td>1</td>
</tr>
</tbody></table>

<p><strong>Nota:</strong> Todos los campos deben completarse conforme a la longitud indicada, es decir si en el número secuencial no completa los 9 dígitos, la clave de acceso estará mal conformada y será motivo de rechazo de la autorización en línea.</p>

<p>El dígito verificador será aplicado sobre toda la clave de acceso (48 dígitos) y deberá ser incorporado por el contribuyente a través del método denominado Módulo 11, con un factor de chequeo ponderado (2), este mecanismo de detección de errores, será verificado al momento de la recepción del comprobante. Cuando el resultado del dígito verificador obtenido sea igual a once (11), el digito verificador será el cero (0) y cuando el resultado del dígito verificador obtenido sea igual a diez 10, el digito verificador será el uno (1).</p>

<p>El código numérico constituye un mecanismo para brindar seguridad al emisor en cada comprobante emitido, el algoritmo numérico para conformar este código es potestad absoluta del contribuyente emisor.</p>

<p>Ver <a href="https://es.wikipedia.org/wiki/C%C3%B3digo_de_control">aquí</a> ejemplo de verificación utilizando algoritmo de módulo 11.</p>
<h1 id='objetos-comunes'>Objetos comunes</h1><h2 id='emisor'>Emisor</h2>
<p>Información del emisor de un comprobante.</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres</td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres</td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco si no es contribuyente especial.</td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>boolean</td>
<td><code>true</code> si está obligado a llevar contabilidad.</td>
</tr>
<tr>
<td>establecimiento</td>
<td><a href="#establecimiento">establecimiento</a></td>
<td>Establecimiento que emite la factura.</td>
</tr>
</tbody></table>
<h2 id='establecimiento'>Establecimiento</h2>
<p>Representa un establecimiento del comercio.</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code></td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres</td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code></td>
</tr>
</tbody></table>
<h2 id='maquina-fiscal'>Máquina fiscal</h2>
<p>Datos de una máquina fiscal.</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>marca</td>
<td>string</td>
<td>Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>modelo</td>
<td>string</td>
<td>Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>serie</td>
<td>string</td>
<td>Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h2 id='reembolso'>Reembolso</h2>
<p>Datos de una factura o liquidación de compras de reembolso.</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del tipo de documento de reembolso equivalente a 41. <strong>Requerido</strong></td>
</tr>
<tr>
<td>documentos</td>
<td>listado de objeto <a href="#documento">Documento</a></td>
<td>Lista de documentos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>subtotal</td>
<td>float</td>
<td>Sumatoria de los subtotales de los documentos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total_impuestos</td>
<td>float</td>
<td>Sumatoria de los totales de impuestos de los documentos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total</td>
<td>float</td>
<td>Subtotal más total de impuestos. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h2 id='documento'>Documento</h2>
<p>Datos de un documento.</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo_establecimiento</td>
<td>string</td>
<td>3 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_punto_emision</td>
<td>string</td>
<td>3 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencia</td>
<td>integer (min. 1 - max. 999999999 )</td>
<td>Número de secuencia del documento. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision</td>
<td>string</td>
<td>Fecha de emisión en formato AAAA-MM-DDHoraZonaHoraria, definido en el estándar <a href="http://tools.ietf.org/html/rfc3339#section-5.6">ISO8601</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>identificacion_proveedor</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion_proveedor</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>impuestos</td>
<td>listado de objeto <a href="#impuesto-item">impuesto</a></td>
<td>Impuestos totales del documento. <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_autorizacion</td>
<td>string</td>
<td>Número de autorización del documento. 10, 37 o 49 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>pais_origen_proveedor</td>
<td>string</td>
<td>Código  de dos caracteres del país origen según <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements">ISO_3166</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo</td>
<td>string</td>
<td>Código de <a href="#tipos-de-documentos">tipos de documentos</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_proveedor</td>
<td>string</td>
<td>Código de <a href="#tipo-de-proveedor">tipo de proveedor</a> de reembolso. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h2 id='tipo-de-proveedor'>Tipo de proveedor</h2>
<table><thead>
<tr>
<th>Tipo</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>Personal natural</td>
<td>01</td>
</tr>
<tr>
<td>Sociedad</td>
<td>02</td>
</tr>
</tbody></table>
<h2 id='info-adicional'>Info adicional</h2>
<p>Información adicional adjunta al documento. Es utilizada para especificar cualquier detalle
que no pueda ser descrito con los elementos que son parte del documento.</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h2 id='persona'>Persona</h2>
<p>Datos de una persona. Utilizado como <strong>comprador</strong> en facturas y notas de crédito, como <strong>sujeto</strong> en retenciones</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono.</td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
</tbody></table>
<h2 id='tipo-de-identificacion'>Tipo de identificación</h2>
<table><thead>
<tr>
<th>Tipo de identificación</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>RUC</td>
<td><code>04</code></td>
</tr>
<tr>
<td>CEDULA</td>
<td><code>05</code></td>
</tr>
<tr>
<td>PASAPORTE</td>
<td><code>06</code></td>
</tr>
<tr>
<td>VENTA A CONSUMIDOR FINAL*</td>
<td><code>07</code></td>
</tr>
<tr>
<td>IDENTIFICACION DELEXTERIOR*</td>
<td><code>08</code></td>
</tr>
<tr>
<td>PLACA</td>
<td><code>09</code></td>
</tr>
</tbody></table>
<h2 id='total-impuesto'>Total Impuesto</h2>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>.</td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible.</td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total.</td>
</tr>
</tbody></table>
<h2 id='impuesto-item'>Impuesto Item</h2>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>.</td>
</tr>
<tr>
<td>base_imponible</td>
<td>float (hasta 2 cifras decimales)</td>
<td>Base imponible.</td>
</tr>
<tr>
<td>valor</td>
<td>float (hasta 2 cifras decimales)</td>
<td>Valor del total.</td>
</tr>
<tr>
<td>tarifa</td>
<td>float (hasta 2 cifras decimales)</td>
<td>Porcentaje actual del impuesto expresado por un número entre 0.0 y 100.0</td>
</tr>
</tbody></table>
<h2 id='envio-sri'>Envío SRI</h2>
<p>Contiene la información y el estado de la fase de envío al SRI</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>mensajes</td>
<td>listado de objeto <a href="#mensajes-de-respuesta-sri">mensaje SRI</a></td>
<td>Listado de mensajes.</td>
</tr>
<tr>
<td>estado</td>
<td>string</td>
<td>Posibles valores: <code>RECIBIDA</code>, <code>DEVUELTA</code></td>
</tr>
<tr>
<td>fecha</td>
<td>string</td>
<td>Fecha en la que se realizó el envío en formato AAAA-MM-DDHoraZonaHoraria, definido en el estándar <a href="http://tools.ietf.org/html/rfc3339#section-5.6">ISO8601</a>.</td>
</tr>
</tbody></table>
<h2 id='autorizacion-sri'>Autorización SRI</h2>
<p>Contiene la información y el estado de la fase de autorización del comprobante.</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>mensajes</td>
<td>listado de objeto <a href="#mensajes-de-respuesta-sri">mensaje SRI</a></td>
<td>Listado de mensajes.</td>
</tr>
<tr>
<td>estado</td>
<td>string</td>
<td>Posibles valores: <code>AUTORIZADO</code>, <code>NO AUTORIZADO</code></td>
</tr>
<tr>
<td>numero</td>
<td>string</td>
<td>Número de autorización.</td>
</tr>
<tr>
<td>fecha</td>
<td>string</td>
<td>Fecha en la que se otorgó la autorización en formato AAAA-MM-DDHoraZonaHoraria, definido en el estándar <a href="http://tools.ietf.org/html/rfc3339#section-5.6">ISO8601</a>.</td>
</tr>
</tbody></table>
<h2 id='mensajes-de-respuesta-sri'>Mensajes de respuesta SRI</h2>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>identificador</td>
<td>string</td>
<td>Número con el que el SRI identifica al mensaje.</td>
</tr>
<tr>
<td>mensaje</td>
<td>string</td>
<td>Descripción del error, información o advertencia.</td>
</tr>
<tr>
<td>tipo</td>
<td>string</td>
<td>Posibles valores: <code>INFORMATIVO</code>, <code>ADVERTENCIA</code>, <code>ERROR</code></td>
</tr>
<tr>
<td>informacion_adicional</td>
<td>string</td>
<td>Información adicional del mensaje.</td>
</tr>
</tbody></table>

<h2 id="item-de-factura">Item de factura, nota de crédito y liquidación de compras</h2>

<p>Representa un producto o servicio del comercio.</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>descripcion</td>
<td>string (máximo 300 caracteres)</td>
<td>Descripción del ítem. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_principal</td>
<td>string (máximo 25 caracteres)</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>codigo_auxiliar</td>
<td>string (máximo 25 caracteres)</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>cantidad</td>
<td>float (hasta 6 cifras decimales)</td>
<td>Cantidad de items. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_unitario</td>
<td>float (hasta 6 cifras decimales)</td>
<td>Precio unitario. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float (hasta 2 cifras decimales)</td>
<td>El descuento es aplicado por cada producto, expresado en valor monetario. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_total_sin_impuestos</td>
<td>float (hasta 2 cifras decimales)</td>
<td>Precio antes de los impuestos. Se obtiene multiplicando la <code>cantidad</code> por el <code>precio_unitario</code></td>
</tr>
<tr>
<td>unidad_medida</td>
<td>string</td>
<td>Unidad de medida <strong>Requerido para facturas de exportación</strong></td>
</tr>
<tr>
<td>impuestos</td>
<td>listado de objetos tipo <a href="#impuesto-item">impuesto item</a></td>
<td>Impuestos grabados sobre el producto. <strong>Requerido</strong></td>
</tr>
<tr>
<td>detalles_adicionales</td>
<td>object</td>
<td>Diccionario de datos de carácter adicional. Ejemplo:<br><code>{&quot;marca&quot;: &quot;Ferrari&quot;, &quot;chasis&quot;: &quot;UANEI832-NAU101&quot;}</code></td>
</tr>
</tbody></table>

<h2 id="retencion-de-factura">Retención en factura </h2>

<p>Caso específico de Retenciones en la Comercializadores / Distribuidores de derivados del Petróleo y Retención presuntiva de IVA a los Editores, Distribuidores y Voceadores que participan en la comercialización de periódicos y/o revistas.</p>

<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto-para-la-retencion-en-la-factura">tipo de impuesto para la retención en la factura</a>.  <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#retencion-de-iva-presuntivo-y-renta">porcentaje del impuesto</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>float (hasta 2 cifras decimales)</td>
<td>Porcentaje actual del impuesto.  <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float (hasta 2 cifras decimales)</td>
<td>Valor del impuesto.  <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h1 id='catalogo'>Catálogo</h1><h2 id='tipos-de-impuesto'>Tipos de impuesto</h2>
<table><thead>
<tr>
<th>Impuesto</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>IVA</td>
<td>2</td>
</tr>
<tr>
<td>ICE</td>
<td>3</td>
</tr>
<tr>
<td>IRBPNR</td>
<td>5</td>
</tr>
</tbody></table>
<h2 id='codigo-de-porcentaje-de-iva'>Código de Porcentaje de IVA</h2>
<table><thead>
<tr>
<th>Porcentaje de IVA</th>
<th>Código</th>
<th>Tarifa</th>
</tr>
</thead><tbody>
<tr>
<td>0%</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>12%</td>
<td>2</td>
<td>12</td>
</tr>
<tr>
<td>14%</td>
<td>3</td>
<td>14</td>
</tr>
<tr>
<td>No Objeto de Impuesto</td>
<td>6</td>
<td>-</td>
</tr>
<tr>
<td>Exento de IVA</td>
<td>7</td>
<td>-</td>
</tr>
</tbody></table>
<h2 id='tipos-de-impuesto-para-la-retencion'>Tipos de impuesto para la retención</h2>
<table><thead>
<tr>
<th>Impuesto</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>RENTA</td>
<td>1</td>
</tr>
<tr>
<td>IVA</td>
<td>2</td>
</tr>
<tr>
<td>ISD</td>
<td>6</td>
</tr>
</tbody></table>
<h2 id='tipos-de-impuesto-para-la-retencion-en-la-factura'>Tipos de impuesto para la retención en la factura</h2>
<p>Caso específico de Retenciones en la Comercializadores / Distribuidores de derivados del
Petróleo y Retención presuntiva de IVA a los Editores, Distribuidores y Voceadores que
participan en la comercialización de periódicos y/o revistas.</p>

<table><thead>
<tr>
<th>Impuesto</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>IVA PRESUNTIVO Y RENTA</td>
<td>4</td>
</tr>
</tbody></table>
<h2 id='retencion-de-iva'>Retención de IVA</h2>
<table><thead>
<tr>
<th>Porcentaje IVA</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>10%</td>
<td>9</td>
</tr>
<tr>
<td>20%</td>
<td>10</td>
</tr>
<tr>
<td>30%</td>
<td>1</td>
</tr>
<tr>
<td>70%</td>
<td>2</td>
</tr>
<tr>
<td>100%</td>
<td>3</td>
</tr>
</tbody></table>

<p><strong>Retención en cero</strong></p>

<table><thead>
<tr>
<th>Porcentaje IVA</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>0%</td>
<td>7</td>
</tr>
</tbody></table>

<p><strong>No procede retención</strong></p>

<table><thead>
<tr>
<th>Porcentaje IVA</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>0%</td>
<td>8</td>
</tr>
</tbody></table>
<h2 id='retencion-isd'>Retención ISD</h2>
<table><thead>
<tr>
<th>Porcentaje IVA</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>5%</td>
<td>4580</td>
</tr>
</tbody></table>
<h2 id='retencion-de-iva-presuntivo-y-renta'>Retención de IVA Presuntivo y Renta</h2>
<p>Caso específico de Retenciones en la Comercializadores / Distribuidores de derivados del
Petróleo y Retención presuntiva de IVA a los Editores, Distribuidores y Voceadores que
participan en la comercialización de periódicos y/o revistas.</p>

<p><strong>Retención IVA</strong></p>

<table><thead>
<tr>
<th>Porcentaje IVA presuntivo</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>100%</td>
<td>3</td>
</tr>
<tr>
<td>12%  (Editores a Margen de Comercialización Voceadores)</td>
<td>4</td>
</tr>
<tr>
<td>100% (Venta periódicos y/o Revistas a Distribuidores)</td>
<td>5</td>
</tr>
<tr>
<td>100% (Venta periódicos y/o Revistas a Voceadores)</td>
<td>6</td>
</tr>
</tbody></table>

<p><strong>Retención Renta</strong></p>

<table><thead>
<tr>
<th>Porcentaje Renta</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>0.2%</td>
<td>327</td>
</tr>
<tr>
<td>0.3%</td>
<td>328</td>
</tr>
</tbody></table>
<h2 id='tipos-de-documentos'>Tipos de documentos</h2>
<table><thead>
<tr>
<th>Documento</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>Factura</td>
<td>01</td>
</tr>
<tr>
<td>Liquidación de Compra</td>
<td>03</td>
</tr>
<tr>
<td>Nota de Crédito</td>
<td>04</td>
</tr>
<tr>
<td>Nota de Débito</td>
<td>05</td>
</tr>
<tr>
<td>Guía de Remisión</td>
<td>06</td>
</tr>
<tr>
<td>Comprobante de Retención</td>
<td>07</td>
</tr>
</tbody></table>
<h2 id='tipos-de-forma-de-pago'>Tipos de forma de pago</h2>
<table><thead>
<tr>
<th>Forma de pago</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>Efectivo</td>
<td>efectivo</td>
</tr>
<tr>
<td>Cheque</td>
<td>cheque</td>
</tr>
<tr>
<td>Débito de cuenta bancaria</td>
<td>debito_cuenta_bancaria</td>
</tr>
<tr>
<td>Transferencia bancaria</td>
<td>transferencia</td>
</tr>
<tr>
<td>Depósito en cuenta (Corriente / Ahorros)</td>
<td>deposito_cuenta_bancaria</td>
</tr>
<tr>
<td>Tarjeta de débito</td>
<td>tarjeta_debito</td>
</tr>
<tr>
<td>Dinero electrónico Ecuador</td>
<td>dinero_electronico_ec</td>
</tr>
<tr>
<td>Tarjeta prepago</td>
<td>tarjeta_prepago</td>
</tr>
<tr>
<td>Tarjeta de crédito</td>
<td>tarjeta_credito</td>
</tr>
<tr>
<td>Otros</td>
<td>otros</td>
</tr>
<tr>
<td>Endoso de títulos</td>
<td>endoso_titulos</td>
</tr>
</tbody></table>
<h2 id='tipos-de-forma-de-pago-del-sri'>Tipos de forma de pago del SRI</h2>
<table><thead>
<tr>
<th>Forma de pago</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>Sin utilización del sistema financiero</td>
<td>01</td>
</tr>
<tr>
<td>Compensación de deudas</td>
<td>15</td>
</tr>
<tr>
<td>Tarjeta de débito</td>
<td>16</td>
</tr>
<tr>
<td>Dinero electrónico</td>
<td>17</td>
</tr>
<tr>
<td>Tarjeta prepago</td>
<td>18</td>
</tr>
<tr>
<td>Tarjeta de crédito</td>
<td>19</td>
</tr>
<tr>
<td>Otros con utilización del sistema financiero</td>
<td>20</td>
</tr>
<tr>
<td>Endoso de títulos</td>
<td>21</td>
</tr>
</tbody></table>
<h2 id='equivalencia-entre-formas-de-pago-datil-y-formas-de-pago-del-sri'>Equivalencia entre formas de pago Dátil y formas de pago del SRI</h2>
<table><thead>
<tr>
<th>Forma de pago Dátil</th>
<th>Código</th>
<th>Forma de pago SRI</th>
<th>Código</th>
</tr>
</thead><tbody>
<tr>
<td>Efectivo</td>
<td>efectivo</td>
<td>Sin utilización del sistema financiero</td>
<td>01</td>
</tr>
<tr>
<td>Cheque</td>
<td>cheque</td>
<td>Otros con utilización del sistema financiero</td>
<td>20</td>
</tr>
<tr>
<td>Débito bancario</td>
<td>debito_cuenta_bancaria</td>
<td>Otros con utilización del sistema financiero</td>
<td>20</td>
</tr>
<tr>
<td>Transferencia bancaria</td>
<td>transferencia</td>
<td>Otros con utilización del sistema financiero</td>
<td>20</td>
</tr>
<tr>
<td>Tarjeta de crédito</td>
<td>tarjeta_credito</td>
<td>Tarjeta de crédito nacional</td>
<td>19</td>
</tr>
<tr>
<td>Depósito en cuenta (Corriente / Ahorros)</td>
<td>deposito_cuenta_bancaria</td>
<td>Otros con utilización del sistema financiero</td>
<td>20</td>
</tr>
<tr>
<td>Tarjeta de débito</td>
<td>tarjeta_debito</td>
<td>Tarjeta de débito</td>
<td>16</td>
</tr>
<tr>
<td>Dinero electrónico Ecuador</td>
<td>dinero_electronico_ec</td>
<td>Dinero electrónico</td>
<td>17</td>
</tr>
<tr>
<td>Tarjeta prepago</td>
<td>tarjeta_prepago</td>
<td>Tarjeta prepago</td>
<td>18</td>
</tr>
<tr>
<td>Otros</td>
<td>otros</td>
<td>Otros con utilización del sistema financiero</td>
<td>20</td>
</tr>
<tr>
<td>Endoso de títulos</td>
<td>endoso_titulos</td>
<td>Endoso de títulos</td>
<td>21</td>
</tr>
</tbody></table>

<p>Debido a que el Servicio de Rentas Internas exige incluir información del pago,
las facturas a crédito se enviarán al SRI con forma de pago &quot;Otros con utilización del sistema financiero&quot;.</p>
<h1 id='ejemplos-de-archivos-de-configuracion'>Ejemplos de archivos de configuración</h1><h2 id='invoice-ini'>invoice.ini</h2>
<p>Guarda la configuración y queries para la extracción y emisisón electrónica de facturas.
<pre></p>

<p>[Query]
headers = SELECT
  id_factura            id_local,
  secuencial,
  fecha_emision,
  guia_remision,
  moneda,
  clave_acceso,
  tipo_emision
  FROM
  DocElectronicoFactura.cabecera
  WHERE
  info.id_factura in (:sequence)
  ORDER BY id_factura :order</p>

<p>invoice_seller  = SELECT
  ruc,
  obligado_contabilidad,
  contribuyente_especial,
  nombre_comercial,
  razon_social,
  direccion_establecimiento,
  direccion_emisor,
  codigo,
  punto_emision
  FROM
  DocElectronicoFactura.cabecera
  WHERE
  id_factura = ?</p>

<p>invoice_buyer  = SELECT
  identificacion,
  tipo_identificacion,
  razon_social,
  direccion,
  email,
  telefono
  FROM
  FROM
  DocElectronicoFactura.cabecera
  WHERE
  id_factura = ?</p>

<p>invoice_totals  = SELECT
  total_sin_impuestos,
  importe_total,
  propina,
  descuento
  FROM
  DocElectronicoFactura.cabecera
  WHERE
  id_factura = ?</p>

<p>invoice_totals_taxes  = SELECT
  codigo,
  codigo_porcentaje,
  base_imponible,
  valor
  FROM
  DocElectronicoFactura.totales_impuestos
  WHERE
  id_factura = ?</p>

<p>items  = SELECT
  id_detalle,
  codigo_principal,
  codigo_auxiliar,
  descripcion,
  cantidad,
  precio_unitario,
  descuento,
  precio_total_sin_impuestos
  FROM
  DocElectronicoFactura.items
  WHERE
  id_factura = ?</p>

<p>item_taxes  = SELECT
  base_imponible,
  valor,
  tarifa,
  codigo,
  codigo_porcentaje
  FROM
  DocElectronicoFactura.items_impuestos
  WHERE
  id_detalle = ?</p>

<p>item_details = SELECT
  nombre    nombre,
  valor   valor
  FROM
  DocElectronicoFactura.items_detalles_adicionales
  WHERE
  id_detalle = ?</p>

<p>invoice_additional_information = SELECT
  columna_de_nombres    <em>nombre</em>,
  columna_de_valores     <em>valor</em>
  FROM
  DocElectronicoFactura.informacion_adicional
  WHERE
  id_detalle = ?
</pre></p>
<h2 id='credit_note-ini'>credit_note.ini</h2>
<p>Guarda la configuración y queries para la extracción y emisisón electrónica de notas de crédito.
<pre></p>

<p>[Query]
headers = SELECT
  id_nota_credito            id_local,
  secuencial,
  fecha_emision,
  guia_remision,
  moneda,
  clave_acceso,
  tipo_emision,
  fecha_emision_documento_modificado,
  numero_documento_modificado,
  tipo_documento_modificado,
  motivo
  FROM
  DocElectronicoNotaCredito.cabecera
  WHERE
  info.id_nota_credito in (:sequence)
  ORDER BY id_nota_credito :order</p>

<p>credit_note_seller  = SELECT
  ruc,
  obligado_contabilidad,
  contribuyente_especial,
  nombre_comercial,
  razon_social,
  direccion_establecimiento,
  direccion_emisor,
  codigo,
  punto_emision
  FROM
  DocElectronicoNotaCredito.cabecera
  WHERE
  id_nota_credito = ?</p>

<p>credit_note_buyer  = SELECT
  identificacion,
  tipo_identificacion,
  razon_social,
  direccion,
  email,
  telefono
  FROM
  DocElectronicoNotaCredito.cabecera
  WHERE
  id_nota_credito = ?</p>

<p>credit_note_totals  = SELECT
  total_sin_impuestos,
  importe_total
  FROM
  DocElectronicoNotaCredito.cabecera
  WHERE
  id_nota_credito = ?</p>

<p>credit_note_totals_taxes  = SELECT
  codigo,
  codigo_porcentaje,
  base_imponible,
  valor
  FROM
  DocElectronicoNotaCredito.totales_impuestos
  WHERE
  id_nota_credito = ?</p>

<p>items  = SELECT
  id_detalle,
  codigo_principal,
  codigo_auxiliar,
  descripcion,
  cantidad,
  precio_unitario,
  descuento,
  precio_total_sin_impuestos
  FROM
  DocElectronicoNotaCredito.items
  WHERE
  id_nota_credito = ?</p>

<p>item_taxes  = SELECT
  base_imponible,
  valor,
  tarifa,
  codigo,
  codigo_porcentaje
  FROM
  DocElectronicoNotaCredito.items_impuestos
  WHERE
  id_detalle = ?</p>

<p>item_details = SELECT
  nombre    nombre,
  valor   valor
  FROM
  DocElectronicoNotaCredito.items_detalles_adicionales
  WHERE
  id_detalle = ?</p>

<p>credit_note_additional_information = SELECT
  columna_de_nombres    <em>nombre</em>,
  columna_de_valores     <em>valor</em>
  FROM
  DocElectronicoNotaCredito.informacion_adicional
  WHERE
  id_detalle = ?
</pre></p>
<h2 id='retention-ini'>retention.ini</h2>
<p>Guarda la configuración y queries para la extracción y emisisón electrónica de retenciones.
<pre></p>

<p>[Query]
headers = SELECT
  id_nota_credito             id_local,
  secuencial,
  fecha_emision,
  clave_acceso,
  tipo_emision,
  periodo_fiscal
  FROM
  DocElectronicoRetencion.cabecera
  WHERE
  id_retencion in (:sequence)
  ORDER BY id_retencion :order</p>

<p>retention_seller  = SELECT
  ruc,
  obligado_contabilidad,
  contribuyente_especial,
  nombre_comercial,
  razon_social,
  direccion_establecimiento,
  direccion_emisor,
  codigo,
  punto_emision
  FROM
  DocElectronicoRetencion.cabecera
  WHERE
  id_retencion = ?</p>

<p>retention_recipient  = SELECT
  identificacion,
  tipo_identificacion,
  razon_social,
  direccion,
  email,
  telefono
  FROM
  DocElectronicoRetencion.cabecera
  WHERE
  id_retencion = ?</p>

<p>retention_taxes  = SELECT
    codigo,
    codigo_porcentaje,
    porcentaje,
    base_imponible,
    valor_retenido,
    tipo_documento_sustento,
    numero_documento_sustento,
    fecha_emision_documento_sustento
    FROM 
    DocElectronicoRetencion.impuesto
    WHERE
    id_retencion = ?</p>

<p>retention_additional_information = SELECT
  columna_de_nombres    <em>nombre</em>,
  columna_de_valores     <em>valor</em>
  FROM
  DocElectronicoRetencion.informacion_adicional
  WHERE
  id_retencion = ?
</pre></p>
<h2 id='waybill-ini'>waybill.ini</h2>
<p>Guarda la configuración y queries para la extracción y emisisón electrónica de guías de remisión.
<pre></p>

<p>[Query]
headers = SELECT
  id_guia_remision             id_local,
  secuencial,
  fecha_inicio_transporte,
  fecha_fin_transporte,
  direccion_partida,
  clave_acceso,
  tipo_emision
  FROM
  DocElectronicoGuiaRemision.cabecera
  WHERE
  id_guia_remision in (:sequence)
  ORDER BY id_guia_remision :order</p>

<p>waybill_seller  = SELECT
  ruc,
  obligado_contabilidad,
  contribuyente_especial,
  nombre_comercial,
  razon_social,
  direccion_establecimiento,
  direccion_emisor,
  codigo,
  punto_emision
  FROM
  DocElectronicoGuiaRemision.cabecera
  WHERE
  id_guia_remision = ?</p>

<p>waybill_shipper  = SELECT
  identificacion,
  tipo_identificacion,
  razon_social,
  direccion,
  email,
  telefono
  FROM
  DocElectronicoGuiaRemision.cabecera
  WHERE
  id_guia_remision = ?</p>

<p>waybill_receivers  = SELECT
    id_destinatario     receiver_id,
    razon_social,
    identificacion,
    tipo_identificacion,
    email,
    telefono,
    direccion,
    ruta,
    documento_aduanero_unico,
    codigo_establecimiento_destino,
    fecha_emision_documento_sustento,
    numero_documento_sustento,
    tipo_documento_sustento,
    motivo_traslado,
    numero_autorizacion_documento_sustento
    FROM
    DocElectronicoGuiaRemision.destinatario
    WHERE
    id_guia_remision = ?</p>

<p>waybill_receiver_items = SELECT
    id_detalle,
    descripcion,
    codigo_principal,
    codigo_auxiliar,
    cantidad
    FROM
    DocElectronicoGuiaRemision.detalle
    WHERE
    id_destinatario = ?</p>

<p>item_details = SELECT
  columna_de_nombres    <em>nombre</em>,
  columna_de_valores   <em>valor</em>
  FROM
  DocElectronicoGuiaRemision.items_detalles_adicionales
  WHERE
  id_detalle = ?</p>

<p>waybill_additional_information = SELECT
  columna_de_nombres    <em>nombre</em>,
  columna_de_valores     <em>valor</em>
  FROM
  DocElectronicoRetencion.informacion_adicional
  WHERE
  id_retencion = ?</p>

<p></pre></p>
<h2 id='purchase_settlement-ini'>purchase_settlement.ini</h2>
<p>Guarda la configuración y queries para la extracción y emisisón electrónica de liquidaciones de compra.</p>

<pre>

headers = SELECT
      id id_local,
      secuencial,
      fecha_emision,
      moneda,
      tipo_emision
    FROM
      liquidaciones_compra.liquidacion
    WHERE
      id in (:sequence)
    ORDER BY id :order

purchase_settlement_buyer  = SELECT
      ruc,
      obligado_contabilidad,
      contribuyente_especial,
      nombre_comercial,
      razon_social,
      direccion_establecimiento,
      direccion_matriz direccion_emisor,
      codigo_establecimiento codigo,
      punto_emision
    FROM
      liquidaciones_compra.liquidacion
    WHERE
      id = ?

purchase_settlement_provider = SELECT
      identificador_proveedor identificacion,
      tipo_identificador_proveedor tipo_identificacion,
      razon_social_proveedor razon_social,
      direccion_proveedor direccion
    FROM
      liquidaciones_compra.liquidacion
    WHERE
      id = ?

purchase_settlement_totals  = SELECT
      total_sin_impuestos,
      importe_total,
      descuento
    FROM
      liquidaciones_compra.liquidacion
    WHERE
      id = ?

purchase_settlement_totals_taxes = SELECT
      codigo,
      codigo_porcentaje,
      base_imponible,
      valor
    FROM 
      liquidaciones_compra.total_impuesto
    WHERE
      id_liquidacion = ?

items  = SELECT
      id id_detalle,
      codigo_principal,
      codigo_auxiliar,
      descripcion,
      cantidad,
      unidad_medida,
      precio_unitario,
      descuento,
      precio_total_sin_impuestos
    FROM
      liquidaciones_compra.item
    WHERE
      id_liquidacion = ?

item_taxes  = SELECT
      id_item id_detalle,
      base_imponible,
      valor,
      tarifa,
      codigo,
      codigo_porcentaje
    FROM
      liquidaciones_compra.item_impuesto
    WHERE
      id_item = ?

item_details = SELECT
      nombre    nombre,
      valor   valor
    FROM
      liquidaciones_compra.item_detalle_adicional
    WHERE
      id_item = ?

purchase_settlement_additional_information = SELECT
      nombre    _nombre_,
      valor     _valor_
    FROM
      liquidaciones_compra.info_adicional
    WHERE
      id_liquidacion = ?

purchase_settlement_reimbursement = SELECT
        r.id_reembolso,
        l.codigo_documento_reembolso
      FROM
        liquidaciones_compra.liquidacion AS l JOIN
        liquidaciones_compra.reembolso AS r 
      ON
        l.id = r.id_liquidacion
      WHERE
        id = ?

purchase_settlement_reimbursement_totals = SELECT
        total_comprobante_reembolso subtotal,
        total_base_imponible_reembolso total,
        total_impuesto_reembolso total_impuestos
    FROM
        liquidaciones_compra.liquidacion
    WHERE
        id = ?

purchase_settlement_reimbursement_document = SELECT
        codigo_documento_reembolso codigo,
        id_reembolso id_documento,
        id_proveedor_reembolso,
        tipo_id_proveedor_reembolso,
        codigo_pais_pago_proveedor_reembolso,
        tipo_proveedor_reembolso,
        secuencia_reembolso,
        punto_emision_reembolso,
        fecha_emision_reembolso,
        numero_autorizacion_reembolso,
        codigo_establecimiento_reembolso
    FROM
      liquidaciones_compra.reembolso
    WHERE
      id_reembolso = ?

purchase_settlement_reimbursement_tax = SELECT
        codigo,
        codigo_porcentaje,
        tarifa,
        base_imponible,
        impuesto_reembolso
    FROM
        liquidaciones_compra.reembolso_tax
    WHERE
        id_reembolso = ?

purchase_settlement_fiscal_machine = SELECT
        [marca],
        [modelo],
        [serie]
    FROM
        liquidaciones_compra.maquina_fiscal
    WHERE
        id_liquidacion = ?

</pre>
<h1 id='actualizacion'>Actualización</h1>
<p>Para actualizar el programa Link de Dátil</p>

<ul>
<li>Abra el terminal de windows y detenga el servicio:</li>
</ul>

<p><code>net stop datilink</code></p>

<ul>
<li>Respalde la carpeta de configuración  <code>config</code></li>
</ul>

<p>Windows: <code>C:\Archivos de Programa\Datil\Link\config</code> .</p>

<ul>
<li>Doble click en el desinstalador:</li>
</ul>

<p>Windows: <code>C:\Archivos de Programa\Datil\Link\unins</code></p>

<p>Dentro del directorio de instalación solo debe quedar la carpeta <code>logs</code>. Si otro
archivo o carpeta sigue existiendo, borrarlo.</p>

<ul>
<li><p>Instalar la nueva versión ejecutando el instalador de Link</p></li>
<li><p>Reemplazar la carpeta config recién instalada con la carpeta config respaldada previamente</p></li>
<li><p>Iniciar el servicio con el comando:</p></li>
</ul>

<p><code>net start datilink</code></p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="sql">Ejemplo SQL</a>
          </div>
      </div>
    </div>
  </body>
</html>
