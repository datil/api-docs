<h1 id='configuracion-avanzada'>Configuración avanzada</h1>
<p><strong>Tablas o Vistas</strong></p>

<p>Para que la aplicación <strong>Link</strong> se conecte a su ERP o sistema contable se deben configurar
los <em>queries</em> para extraer información directamente de las tablas  de su base de datos.</p>

<p>Si no desea que <strong>Link</strong> consulte directamente sus tablas puede crear vistas con la información
de los comprobantes a emitir.</p>

<p><strong>Formato</strong></p>

<p>Los queries se guardan siguiendo el formato de archivos <code>.ini</code>. en el directorio
<em>C:/Archivos de Programa/Datil/Link/config/</em>.</p>

<p>En cada archivo <code>.ini</code> cada <em>query</em> está asignado a una variable.</p>

<p>Si aún no ha instalado <strong>Link</strong>, puede crear un archivo <code>.ini</code> de respaldo con los queries configurados.</p>

<p><a href="#ejemplos-de-archivos-de-configuracion">Ver ejemplos de archivos de configuración</a></p>

<p><strong>Nombres de tablas y columnas</strong></p>

<p>Sea directamente o por medio de vistas, dependiendo de su sistema, deberá cambiar los nombres de las tablas  al configurar los <em>queries</em>.</p>

<p>Los nombres de las columnas en las tablas
de su sistema pueden ser distintos pero el resultado de cada <em>query</em> debe tener los nombres establecidos en esta documentación.</p>

<p><strong>Queries opcionales</strong></p>

<p>Algunos queries son opcionales porque la información que extraen no es obligatoria para el SRI, en este caso la variable que se configura en el archivo <code>.ini</code> debe tener asignada el valor de <code>None</code>.</p>

<p>Ejemplo:</p>

<p><code>invoice_additional_information = None</code></p>

<p><code>item_details = None</code></p>

<h2 id="facturas-advanced">Facturas</h2>

<p>Los queries para la emisión electrónica de <strong>facturas</strong> se guardan en el archivo de configuración <code>invoice.ini</code>.</p>

<p><a href="/link-app#invoice-ini">Ejemplo de archivo invoice.ini</a></p>
<h3 id='cabecera'>Cabecera</h3>
<p>Obtiene información de la cabecera de la factura.</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_factura</span>            <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_emision</span><span class="p">,</span>
  <span class="n">guia_remision</span><span class="p">,</span>
  <span class="n">moneda</span><span class="p">,</span>
  <span class="n">clave_acceso</span><span class="p">,</span>
  <span class="n">tipo_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">info</span><span class="p">.</span><span class="n">id_factura</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id_factura</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la factura. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la factura. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision</td>
<td>datetime</td>
<td>Fecha de emisión   <strong>Requerido</strong></td>
</tr>
<tr>
<td>guia_remision</td>
<td>string</td>
<td>Número de guía de remisión asociada a esta factura en formato 001-002-000000003 ([0-9]{3}-[0-9]{3}-[0-9]{9})</td>
</tr>
<tr>
<td>moneda</td>
<td>string</td>
<td>Código <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO</a> de la moneda. <strong>Requerido</strong></td>
</tr>
<tr>
<td>clave_acceso</td>
<td>string</td>
<td>La clave de acceso representa un identificador único del comprobante. Si esta información no es provista, Dátil la generará.<br>¿Cómo <a href="#clave-de-acceso">generar</a> la clave de acceso?</td>
</tr>
<tr>
<td>tipo_emision</td>
<td>integer</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='emisor'>Emisor</h3>
<p>Obtiene información del vendedor en la factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_seller</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='comprador'>Comprador</h3>
<p>Obtiene información del comprador en la factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_buyer</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">telefono</span>
  <span class="k">FROM</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono</td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
</tbody></table>
<h3 id='totales'>Totales</h3>
<p>Obtiene información de los valores totales de la facturas</p>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_totals</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">total_sin_impuestos</span><span class="p">,</span>
  <span class="n">importe_total</span><span class="p">,</span>
  <span class="n">propina</span><span class="p">,</span>
  <span class="n">descuento</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>total_sin_impuestos</td>
<td>float</td>
<td>Total antes de los impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>importe_total</td>
<td>float</td>
<td>Total incluyendo impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>propina</td>
<td>float</td>
<td>Propina total, llamado también servicio. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>Suma de los descuentos de cada ítem y del descuento adicional. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-totales'>Impuestos de totales</h3>
<p>Obtiene información de los impuestos de los totales de la factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_totals_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">totales_impuestos</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='items'>Items</h3>
<p>Obtiene todos los items de una factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">items</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_detalle</span><span class="p">,</span>
  <span class="n">codigo_principal</span><span class="p">,</span>
  <span class="n">codigo_auxiliar</span><span class="p">,</span>
  <span class="n">descripcion</span><span class="p">,</span>
  <span class="n">cantidad</span><span class="p">,</span>
  <span class="n">precio_unitario</span><span class="p">,</span>
  <span class="n">descuento</span><span class="p">,</span>
  <span class="n">precio_total_sin_impuestos</span><span class="p">,</span>
  <span class="n">unidad_medida</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">items</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td>string</td>
<td>Identifica de manera única el ítem o detalle de la factura. Si no hay un solo campo que lo identifique de manera única se debe usar la concatenación de varios.<strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_principal</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_auxiliar</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>descripcion</td>
<td>string</td>
<td>Descripción del ítem. <strong>Requerido</strong></td>
</tr>
<tr>
<td>cantidad</td>
<td>float</td>
<td>Cantidad de items. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_unitario</td>
<td>float</td>
<td>Precio unitario. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>El descuento es aplicado por cada producto. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_total_sin_impuestos</td>
<td>float</td>
<td>Precio antes de los impuestos. Se obtiene multiplicando la <code>cantidad</code> por el <code>precio_unitario</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>unidad_medida</td>
<td>string</td>
<td>Unidad de medida. Ejemplo: Kilos. <strong>Requerido para facturas de exportación</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-items'>Impuestos de items</h3>
<p>Obtiene los impuestos de un item. Este query es <strong>opcional</strong></p>
<pre class="highlight sql tab-sql"><code><span class="n">item_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">items_impuestos</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>float</td>
<td>Porcentaje actual del impuesto expresado por un número entre 0.0 y 100.0 <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem. Este query es <strong>opcional</strong>.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">nombre</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>   <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">items_detalles_adicionales</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional'>Información adicional</h3>
<p>Obtiene la información adicional de la factura. Este query es <strong>opcional</strong></p>

<p>La información adicional de la factura se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la factura:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">informacion_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la factura</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la factura</td>
</tr>
</tbody></table>
<h3 id='pagos'>Pagos</h3>
<p>Obtiene la información de los pagos aplicables a la factura.</p>
<pre class="highlight sql tab-sql"><code><span class="n">payment_methods</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_pago</span><span class="p">,</span>
  <span class="n">medio_pago</span> <span class="n">medio</span><span class="p">,</span>
  <span class="n">total_pago</span> <span class="n">total</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">pagos</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_pago</td>
<td>--</td>
<td>Identificador único del pago, se usa para obtener las [propiedades</td>
</tr>
</tbody></table>

<p>del pago](Propiedades de Pagos), si no hay un identificador único del pago o no hay propiedades de pagos, se debe devolver el <em>id_factura</em>.
medio              | string                  | Código del <a href="#tipos-de-forma-de-pago">tipo de forma de pago</a>. <strong>Requerido</strong>
total               | float                   | Total aplicable a la forma de pago especificada. <strong>Requerido</strong></p>
<h3 id='propiedades-de-pagos'>Propiedades de Pagos</h3>
<p>Obtiene la propiedades de los pagos de determinada factura. Este query es <strong>opcional</strong></p>

<p>Las propiedades de los pagos se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Plazo&#39;:&#39;5&#39;</p>

<p>Se asume que en la tabla consultada una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con propiedades de los pagos:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>plazo</td>
<td>9</td>
</tr>
<tr>
<td>unidad_tiempo</td>
<td>dias</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">payment_method_properties</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoFactura</span><span class="p">.</span><span class="n">propiedades_pagos</span>
  <span class="k">WHERE</span>
  <span class="n">id_pago</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la propiedad del pago</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la propiedad del pago</td>
</tr>
</tbody></table>

<p>Para el Servicio de Rentas Internas de Ecuador (SRI), las únicas propiedades que se tomarán en cuenta son <code>plazo</code> (especifica el plazo del tipo de pago) y <code>unidad_tiempo</code> (especifica la unidad de tiempo en la cual se expresa el plazo).</p>

<p>Las demás propiedades que se especifiquen se registrarán en Dátil como parte del pago, pero no se reportarán al SRI.</p>
<h3 id='credito'>Crédito</h3>
<p>Crédito otorgado en la venta.  Este query es <strong>opcional</strong> , en caso de que todos los pagos se realizan en el momento de la venta, es decir no hay crédito.</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>fecha_vencimiento</td>
<td>string</td>
<td>Fecha de vencimiento en formato AAAA-MM-DD, definido en el estándar <a href="http://tools.ietf.org/html/rfc3339#section-5.6">ISO8601</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>monto</td>
<td>float</td>
<td>Monto otorgado de crédito. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_credit</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">monto</span><span class="p">,</span>
  <span class="n">fecha_vencimiento</span>
  <span class="k">FROM</span>
  <span class="n">facturas</span><span class="p">.</span><span class="n">credito</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre><h3 id='compensacion-solidaria'>Compensación solidaria</h3>
<p>Descuento otorgado a las provincias de Manabí y Esmeraldas. Obligatorio solo para estas provincias.</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>int</td>
<td>Código del porcentaje de IVA . <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>int</td>
<td>Porcentaje de compensación. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor de la compensación. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_compensation</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">facturas</span><span class="p">.</span><span class="n">compensacion</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre><h3 id='exportacion'>Exportación</h3>
<p>Obligatorio <strong>solo</strong> para facturas de exportación</p>

<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>incoterm_termino</td>
<td>string</td>
<td>Código de 3 letras correspondiente al <a href="https://en.wikipedia.org/wiki/Incoterms#Rules_for_any_mode_of_transport">Incoterm</a> . <strong>Requerido</strong></td>
</tr>
<tr>
<td>incoterm_lugar</td>
<td>string</td>
<td>Lugar Incoterm . <strong>Requerido</strong></td>
</tr>
<tr>
<td>incoterm_total_sin_impuestos</td>
<td>string</td>
<td>Total sin impuestos pagado por el incoterm. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_pais_origen</td>
<td>string</td>
<td>Código de dos letras del país origen según <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements">ISO_3166</a>  . <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_pais_destino</td>
<td>string</td>
<td>Código de dos letras del país origen según <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements">ISO_3166</a></td>
</tr>
<tr>
<td>codigo_pais_adquisicion</td>
<td>string</td>
<td>Código de dos letras del país origen según<a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2#Officially_assigned_code_elements">ISO_3166</a></td>
</tr>
<tr>
<td>puerto_origen</td>
<td>string</td>
<td>Puerto de origen. <strong>Requerido</strong></td>
</tr>
<tr>
<td>puerto_destino</td>
<td>string</td>
<td>Puerto de destino. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total_flete_internacional</td>
<td>float</td>
<td>Total del flete internacional</td>
</tr>
<tr>
<td>total_seguro_internacional</td>
<td>float</td>
<td>Total del seguro internacional</td>
</tr>
<tr>
<td>total_gastos_aduaneros</td>
<td>float</td>
<td>Total de los gastos aduaneros</td>
</tr>
<tr>
<td>total_otros_gastos_transporte</td>
<td>float</td>
<td>Total de otros gastos de transporte</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">invoice_export</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">incoterm_termino</span><span class="p">,</span>
  <span class="n">incoterm_lugar</span><span class="p">,</span>
  <span class="n">incoterm_total_sin_impuestos</span><span class="p">,</span>
  <span class="n">codigo_pais_origen</span><span class="p">,</span>
  <span class="n">codigo_pais_destino</span><span class="p">,</span>
  <span class="n">codigo_pais_adquisicion</span><span class="p">,</span>
  <span class="n">puerto_origen</span><span class="p">,</span>
  <span class="n">puerto_destino</span><span class="p">,</span>
  <span class="n">total_flete_internacional</span><span class="p">,</span>
  <span class="n">total_seguro_internacional</span><span class="p">,</span>
  <span class="n">total_gastos_aduaneros</span><span class="p">,</span>
  <span class="n">total_otros_gastos_transporte</span><span class="p">,</span>
  <span class="k">FROM</span>
  <span class="n">facturas</span><span class="p">.</span><span class="n">exportacion</span>
  <span class="k">WHERE</span>
  <span class="n">id_factura</span> <span class="o">=</span> <span class="o">?</span>
</code></pre><h3 id='tablas-recomendadas'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de la factura.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">facturas</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago_propiedad</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">]</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- (OPCIONAL) el ambiente se toma del archivo de configuración de Link App.</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">moneda</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">15</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- USD para dólares</span>
    <span class="p">[</span><span class="n">guia_remision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">17</span><span class="p">),</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">49</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_matriz</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- COMPRADOR</span>
    <span class="p">[</span><span class="n">email_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- TOTALES</span>
    <span class="p">[</span><span class="n">total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">importe_total</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">propina</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento_adicional</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- CREDITO</span>
    <span class="p">[</span><span class="n">monto_credito</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_vencimiento_credito</span><span class="p">]</span> <span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- VALORES RETENIDOS</span>
    <span class="p">[</span><span class="n">valor_retenido_iva</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor_retenido_renta</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">cantidad</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_principal</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_auxiliar</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_unitario</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descripcion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">unidad_medida</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span>

<span class="p">)</span>

<span class="c1">-- FACTURA: IMPUESTOS DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- porcentaje</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_item_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: DETALLES ADICIONALES DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_items_detalles_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: IMPUESTOS TOTALES</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_total_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_factura</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: INFORMACION ADICIONAL DE LA FACTURA</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_informacion_adicional</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_factura</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: PAGOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">fecha</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">medio</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">notas</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="k">max</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">monto</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: PROPIEDADES DE PAGOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago_propiedad</span><span class="p">](</span>
  <span class="p">[</span><span class="n">id_pago</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">pago</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
  <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">CONSTRAINT</span> <span class="n">PK_pago_propiedad</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_pago</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: CREDITO</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">credito</span><span class="p">](</span>
  <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
  <span class="p">[</span><span class="n">monto</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="p">[</span><span class="n">fecha_vencimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: COMPENSACION SOLIDARIA</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">compensacion</span><span class="p">](</span>
  <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
  <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- FACTURA: EXPORTACION</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">exportacion</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_factura</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">facturas</span><span class="p">].[</span><span class="n">factura</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">incoterm_termino</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">incoterm_lugar</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">incoterm_total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_pais_origen</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_pais_destino</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_pais_adquisicion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">puerto_origen</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">puerto_destino</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_flete_internacional</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_seguro_internacional</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_gastos_aduaneros</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_otros_gastos_transporte</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>
</code></pre>
<h2 id="notas-credito-advanced">Notas de crédito</h2>

<p>Los queries para la emisión electrónica de <strong>notas de crédito</strong> se guardan en el archivo de configuración <code>credit_note.ini</code>.</p>

<p><a href="/link-app#credit_note-ini">Ejemplo de archivo credit_note.ini</a></p>
<h3 id='cabecera-2'>Cabecera</h3>
<p>Obtiene información de la cabecera de la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_nota_credito</span>             <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_emision</span><span class="p">,</span>
  <span class="n">moneda</span><span class="p">,</span>
  <span class="n">clave_acceso</span><span class="p">,</span>
  <span class="n">tipo_emision</span><span class="p">,</span>
  <span class="n">fecha_emision_documento_modificado</span><span class="p">,</span>
  <span class="n">numero_documento_modificado</span><span class="p">,</span>
  <span class="n">tipo_documento_modificado</span><span class="p">,</span>
  <span class="n">motivo</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id_nota_credito</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la nota de crédito. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la nota de crédito. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision</td>
<td>datetime</td>
<td>Fecha de emisión   <strong>Requerido</strong></td>
</tr>
<tr>
<td>moneda</td>
<td>string</td>
<td>Código <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO</a> de la moneda. <strong>Requerido</strong></td>
</tr>
<tr>
<td>clave_acceso</td>
<td>string</td>
<td>La clave de acceso representa un identificador único del comprobante. Si esta información no es provista, Dátil la generará.<br>¿Cómo <a href="#clave-de-acceso">generar</a> la clave de acceso?</td>
</tr>
<tr>
<td>tipo_emision</td>
<td>integer</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision_documento_modificado</td>
<td>datetime</td>
<td>Fecha de emisión en formato AAAA-MM-DDHoraZonaHoraria del documento modificado, definido en el estándar <a href="http://tools.ietf.org/html/rfc3339#section-5.6">ISO8601</a>.  <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_documento_modificado</td>
<td>string</td>
<td>Número completo del documento que se está afectando. Normalmente facturas. Ejm: 001-002-010023098 <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_documento_modificado</td>
<td>string</td>
<td>Códigos de <a href="#tipos-de-documentos">tipos de documentos</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>motivo</td>
<td>string</td>
<td>Motivo de la operación. Ejm: Devolución de producto. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='vendedor'>Vendedor</h3>
<p>Obtiene información del vendedor en la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_seller</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='comprador-2'>Comprador</h3>
<p>Obtiene información del comprador en la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_buyer</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">telefono</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono</td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
</tbody></table>
<h3 id='totales-2'>Totales</h3>
<p>Obtiene información de los valores totales de la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_totals</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">total_sin_impuestos</span><span class="p">,</span>
  <span class="n">importe_total</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>total_sin_impuestos</td>
<td>float</td>
<td>Total antes de los impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>importe_total</td>
<td>float</td>
<td>Total incluyendo impuestos. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-totales-2'>Impuestos de totales</h3>
<p>Obtiene información de los impuestos de los totales de la nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_totals_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">totales_impuestos</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='items-2'>Items</h3>
<p>Obtiene todos los items de una nota de crédito</p>
<pre class="highlight sql tab-sql"><code><span class="n">items</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_detalle</span><span class="p">,</span>
  <span class="n">codigo_principal</span><span class="p">,</span>
  <span class="n">codigo_auxiliar</span><span class="p">,</span>
  <span class="n">descripcion</span><span class="p">,</span>
  <span class="n">cantidad</span><span class="p">,</span>
  <span class="n">precio_unitario</span><span class="p">,</span>
  <span class="n">descuento</span><span class="p">,</span>
  <span class="n">precio_total_sin_impuestos</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">items</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td>string</td>
<td>Identifica de manera única el ítem o detalle de la nota de crédito. Si no hay un solo campo que lo identifique de manera única se debe usar la concatenación de varios.<strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_principal</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_auxiliar</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>descripcion</td>
<td>string</td>
<td>Descripción del ítem. <strong>Requerido</strong></td>
</tr>
<tr>
<td>cantidad</td>
<td>float</td>
<td>Cantidad de items. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_unitario</td>
<td>float</td>
<td>Precio unitario. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>El descuento es aplicado por cada producto. <strong>Requerido</strong></td>
</tr>
<tr>
<td>precio_total_sin_impuestos</td>
<td>float</td>
<td>Precio antes de los impuestos. Se obtiene multiplicando la <code>cantidad</code> por el <code>precio_unitario</code> <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-items-2'>Impuestos de items</h3>
<p>Obtiene los impuestos de un item</p>
<pre class="highlight sql tab-sql"><code><span class="n">item_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">items_impuestos</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>float</td>
<td>Porcentaje actual del impuesto expresado por un número entre 0.0 y 100.0 <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items-2'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem. Este query es opcional.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>   <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">items_detalles_adicionales</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional-2'>Información adicional</h3>
<p>Obtiene la información adicional de la nota de crédito.</p>

<p>La información adicional de la nota de crédito se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la nota de crédito:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">credit_note_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">informacion_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_nota_credito</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la nota de crédito</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la nota de crédito</td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items-3'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem. Este query es opcional.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>   <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoNotaCredito</span><span class="p">.</span><span class="n">items_detalles_adicionales</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='tablas-recomendadas-2'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de la nota de crédito.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code>
<span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">notas_de_credito</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">]</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">moneda</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">15</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">49</span><span class="p">),</span>
    <span class="c1">-- DOCUMENTO MODIFICADO</span>
    <span class="p">[</span><span class="n">fecha_emision_documento_modificado</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">17</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_documento_modificado</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">motivo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_matriz</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- COMPRADOR</span>
    <span class="p">[</span><span class="n">email_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- TOTALES</span>
    <span class="p">[</span><span class="n">total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">importe_total</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_nota_credito</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">cantidad</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_principal</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_auxiliar</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_unitario</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descripcion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: IMPUESTOS DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- porcentaje</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_item_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: DETALLES ADICIONALES DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_items_detalles_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: IMPUESTOS TOTALES</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_nota_credito</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_total_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_nota_credito</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- NOTA DE CRÉDITO: INFORMACION ADICIONAL DE LA NOTA DE CRÉDITO</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_nota_credito</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">notas_de_credito</span><span class="p">].[</span><span class="n">nota_de_credito</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_informacion_adicional</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_nota_credito</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

</code></pre>
<h2 id="retencion-advanced">Comprobantes de Retención</h2>

<p>Los queries para la emisión electrónica de <strong>retención</strong> se guardan en el archivo de configuración <code>retention.ini</code>.</p>

<p><a href="/link-app#retention-ini">Ejemplo de archivo retention.ini</a></p>
<h3 id='cabecera-3'>Cabecera</h3>
<p>Obtiene información de la cabecera de la retención</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_nota_credito</span>             <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_emision</span><span class="p">,</span>
  <span class="n">clave_acceso</span><span class="p">,</span>
  <span class="n">tipo_emision</span><span class="p">,</span>
  <span class="n">periodo_fiscal</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id_retencion</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la retención. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la retención. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision</td>
<td>datetime</td>
<td>Fecha de emisión   <strong>Requerido</strong></td>
</tr>
<tr>
<td>clave_acceso</td>
<td>string</td>
<td>La clave de acceso representa un identificador único del comprobante. Si esta información no es provista, Dátil la generará.<br>¿Cómo <a href="#clave-de-acceso">generar</a> la clave de acceso?</td>
</tr>
<tr>
<td>tipo_emision</td>
<td>integer</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
<tr>
<td>periodo_fiscal</td>
<td>string</td>
<td>Mes y año en el siguiente formato MM/AAAA. Ejm: 12/2015 <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='emisor-2'>Emisor</h3>
<p>Obtiene información del vendedor en la retención</p>
<pre class="highlight sql tab-sql"><code><span class="n">retention_seller</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='sujeto-retenido'>Sujeto retenido</h3>
<p>Obtiene información del sujeto retenido en la retención</p>
<pre class="highlight sql tab-sql"><code><span class="n">retention_recipient</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">telefono</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono</td>
</tr>
</tbody></table>
<h3 id='impuestos-de-la-retencion'>Impuestos de la retención</h3>
<p>Obtiene información de los impuestos de la retención</p>
<pre class="highlight sql tab-sql"><code><span class="n">retention_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
    <span class="n">codigo</span><span class="p">,</span>
    <span class="n">codigo_porcentaje</span><span class="p">,</span>
    <span class="n">porcentaje</span><span class="p">,</span>
    <span class="n">base_imponible</span><span class="p">,</span>
    <span class="n">valor_retenido</span><span class="p">,</span>
    <span class="n">tipo_documento_sustento</span><span class="p">,</span>
    <span class="n">numero_documento_sustento</span><span class="p">,</span>
    <span class="n">fecha_emision_documento_sustento</span>
    <span class="k">FROM</span>
    <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">impuesto</span>
    <span class="k">WHERE</span>
    <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código de <a href="#tipos-de-impuesto-para-la-retencion">tipo de impuesto</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td><a href="#retencion-de-iva">Código del porcentaje</a> a aplicar dentro del tipo de impuesto <strong>Requerido</strong></td>
</tr>
<tr>
<td>porcentaje</td>
<td>string</td>
<td>Porcentaje a retener <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor_retenido</td>
<td>float</td>
<td>Valor retenido. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_documento_sustento</td>
<td>string</td>
<td>Códigos de <a href="#tipos-de-documentos">tipos de documentos</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_documento_sustento</td>
<td>string</td>
<td>Número completo del documento que se está afectando. Normalmente facturas. Ejm: 001-002-010023098 <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision_documento_sustento</td>
<td>datetime</td>
<td>Fecha de emisión del documento sustento de la retención_<em>Requerido</em>_</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional-3'>Información adicional</h3>
<p>Obtiene la información adicional de la retención.</p>

<p>La información adicional de la retención se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la retención:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">retention_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">informacion_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la rentención</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la retención</td>
</tr>
</tbody></table>
<h3 id='tablas-recomendadas-3'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de la retención.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code>
<span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">retenciones</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">item</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">retencion</span><span class="p">]</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">retencion</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">49</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">periodo_fiscal</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">7</span><span class="p">),</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_matriz</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- SUJETO RETENIDO</span>
    <span class="p">[</span><span class="n">email_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono_sujeto</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- RETENCION: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_retencion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">retencion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">5</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">17</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor_retenido</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- RETENCION: INFORMACION ADICIONAL DE LA RETENCION</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_retencion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">retenciones</span><span class="p">].[</span><span class="n">retencion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_informacion_adicional</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_retencion</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

</code></pre>
<h2 id="guias-remision-advanced">Guías de Remisión</h2>

<p>Los queries para la emisión electrónica de <strong>guías de remisión</strong> se guardan en el archivo de configuración <code>waybill.ini</code>.</p>

<p><a href="/link-app#waybill-ini">Ejemplo de archivo waybill.ini</a></p>
<h3 id='cabecera-4'>Cabecera</h3>
<p>Obtiene información de la cabecera de la guía de remisión</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_guia_remision</span>             <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_inicio_transporte</span><span class="p">,</span>
  <span class="n">fecha_fin_transporte</span><span class="p">,</span>
  <span class="n">direccion_partida</span><span class="p">,</span>
  <span class="n">clave_acceso</span><span class="p">,</span>
  <span class="n">tipo_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_guia_remision</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id_guia_remision</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la guía de remisión. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la retención. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_inicio_transporte</td>
<td>datetime</td>
<td>Fecha en la que inicia el transporte dada la guía de remisión <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_fin_transporte</td>
<td>datetime</td>
<td>Fecha en la que termina el transporte dada la guía de remisión <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_partida</td>
<td>string</td>
<td>Dirección de partida</td>
</tr>
<tr>
<td>clave_acceso</td>
<td>string</td>
<td>La clave de acceso representa un identificador único del comprobante. Si esta información no es provista, Dátil la generará.<br>¿Cómo <a href="#clave-de-acceso">generar</a> la clave de acceso?</td>
</tr>
<tr>
<td>tipo_emision</td>
<td>integer</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='vendedor-2'>Vendedor</h3>
<p>Obtiene información del vendedor en la guía de remisión</p>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_seller</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_guia_remision</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='transportista'>Transportista</h3>
<p>Obtiene información del transportista en la guía de remisión</p>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_shipper</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">telefono</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">cabecera</span>
  <span class="k">WHERE</span>
  <span class="n">id_guia_remision</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono</td>
</tr>
</tbody></table>
<h3 id='destinatarios'>Destinatarios</h3>
<p>Obtiene información de los destinatarios en la guía de remisión</p>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_receivers</span>  <span class="o">=</span> <span class="k">SELECT</span>
    <span class="n">id_destinatario</span>     <span class="n">receiver_id</span><span class="p">,</span>
    <span class="n">razon_social</span><span class="p">,</span>
    <span class="n">identificacion</span><span class="p">,</span>
    <span class="n">tipo_identificacion</span><span class="p">,</span>
    <span class="n">email</span><span class="p">,</span>
    <span class="n">telefono</span><span class="p">,</span>
    <span class="n">direccion</span><span class="p">,</span>
    <span class="n">ruta</span><span class="p">,</span>
    <span class="n">documento_aduanero_unico</span><span class="p">,</span>
    <span class="n">codigo_establecimiento_destino</span><span class="p">,</span>
    <span class="n">fecha_emision_documento_sustento</span><span class="p">,</span>
    <span class="n">numero_documento_sustento</span><span class="p">,</span>
    <span class="n">tipo_documento_sustento</span><span class="p">,</span>
    <span class="n">motivo_traslado</span><span class="p">,</span>
    <span class="n">numero_autorizacion_documento_sustento</span>
    <span class="k">FROM</span>
    <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">destinatario</span>
    <span class="k">WHERE</span>
    <span class="n">id_guia_remision</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>receiver_id</td>
<td>string</td>
<td>Identifica de manera única al destinatario en la guía de remisión. <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social del destinatario. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>email</td>
<td>string</td>
<td>Correo electrónico del destinatario. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>telefono</td>
<td>string</td>
<td>Teléfono del destinatario</td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección del destinatario</td>
</tr>
<tr>
<td>ruta</td>
<td>string</td>
<td>Ruta de transporte. Máximo 300 caracteres.</td>
</tr>
<tr>
<td>documento_aduanero_unico</td>
<td>string</td>
<td>Máximo 20 caracteres.</td>
</tr>
<tr>
<td>fecha_emision_documento_sustento</td>
<td>datetime</td>
<td>Fecha de emisión del documento sustento de la guía de remisión, usualmente una factura.  <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_documento_sustento</td>
<td>string</td>
<td>Número completo del documento que detalla la mercadería a transportar. Normalmente facturas. Ejm: 001-002-010023098</td>
</tr>
<tr>
<td>codigo_establecimiento_destino</td>
<td>string</td>
<td>Número establecimiento que recibe la entrega.  <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_documento_sustento</td>
<td>string</td>
<td>Número completo del documento que detalla la mercadería a transportar. Normalmente facturas. Ejm: 001-002-010023098 <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_documento_sustento</td>
<td>string</td>
<td>tipo_documento_sustento</td>
</tr>
<tr>
<td>motivo_traslado</td>
<td>string</td>
<td>Motivo del traslado. Ejm: Entrega de mercadería. <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_autorizacion_documento_sustento</td>
<td>string</td>
<td>Autorización del documento de sustento.</td>
</tr>
</tbody></table>
<h3 id='items-del-destinatario'>Items del destinatario</h3>
<p>Obtiene la información de los items que recibirá el destinatario</p>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_receiver_items</span> <span class="o">=</span> <span class="k">SELECT</span>
    <span class="n">id_detalle</span><span class="p">,</span>
    <span class="n">descripcion</span><span class="p">,</span>
    <span class="n">codigo_principal</span><span class="p">,</span>
    <span class="n">codigo_auxiliar</span><span class="p">,</span>
    <span class="n">cantidad</span>
    <span class="k">FROM</span>
    <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">detalle</span>
    <span class="k">WHERE</span>
    <span class="n">id_destinatario</span> <span class="o">=</span> <span class="o">?</span>

</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td>string</td>
<td>Identifica de manera única el ítem o detalle de la factura. Si no hay un solo campo que lo identifique de manera única se debe usar la concatenación de varios.<strong>Requerido</strong></td>
</tr>
<tr>
<td>descripcion</td>
<td>string</td>
<td>Descripción del ítem. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_principal</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_auxiliar</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>cantidad</td>
<td>float</td>
<td>Cantidad de items. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items-4'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem. Este query es opcional.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>   <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoGuiaRemision</span><span class="p">.</span><span class="n">items_detalles_adicionales</span>
  <span class="k">WHERE</span>
  <span class="n">id_detalle</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional-4'>Información adicional</h3>
<p>Obtiene la información adicional de la guía de remisión.</p>

<p>La información adicional de la guía de remisión se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada
una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la guía de remisión:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">waybill_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">columna_de_nombres</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">columna_de_valores</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">DocElectronicoRetencion</span><span class="p">.</span><span class="n">informacion_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_retencion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la rentención</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la retención</td>
</tr>
</tbody></table>
<h3 id='tablas-recomendadas-4'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de la guía de remisión.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">guias_de_remision</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">guia_remision</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">destinatario</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">]</span>
<span class="k">DROP</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">]</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">guia_remision</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_inicio_transporte</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_fin_transporte</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_partida</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">49</span><span class="p">),</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- TRANSPORTISTA</span>
    <span class="p">[</span><span class="n">email_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono_comprador</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">placa</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- GUIA DE REMISION: DESTINATARIOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">destinatario</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_destinatario</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">guia_remision</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">email</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">254</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificacion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_identificacion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">telefono</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">200</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">17</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_autorizacion_documento_sustento</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ruta</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">motivo_traslado</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">documento_aduanero_unico</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento_destino</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- GUIA DE REMISION: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_destinatario</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">destinatario</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">cantidad</span><span class="p">]</span> <span class="p">[</span><span class="n">decimal</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_principal</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_auxiliar</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descripcion</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- GUIA DE REMISION: DETALLES ADICIONALES DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_items_detalles_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- GUIA DE REMISION: INFORMACION ADICIONAL DE LA GUIA DE REMISION</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">informacion_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_guia_remision</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">guias_de_remision</span><span class="p">].[</span><span class="n">guia_remision</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_informacion_adicional</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_guia_remision</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

</code></pre>
<h2 id="liq-compra-advanced">Liquidaciones de compra</h2>

<p>Los queries para la emisión electrónica de <strong>liquidaciones de compra</strong> se guardan en el archivo de configuración <code>purchase_settlement.ini</code>.</p>

<p><a href="/link-app#purchase_settlement-ini">Ejemplo de archivo purchase_settlement.ini</a></p>
<h3 id='cabecera-5'>Cabecera</h3>
<p>Obtiene información de la cabecera de la liquidación de compra</p>
<pre class="highlight sql tab-sql"><code><span class="n">headers</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id</span>                      <span class="n">id_local</span><span class="p">,</span>
  <span class="n">secuencial</span><span class="p">,</span>
  <span class="n">fecha_emision</span><span class="p">,</span>
  <span class="n">moneda</span><span class="p">,</span>
  <span class="n">tipo_emision</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="k">in</span> <span class="p">(:</span><span class="n">sequence</span><span class="p">)</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span> <span class="p">:</span><span class="k">order</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_local</td>
<td>int o string</td>
<td>Identifica de manera única la liquidación de compra. <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencial</td>
<td>string</td>
<td>Número de secuencia de la liquidación. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision</td>
<td>datetime</td>
<td>Fecha en la que se emite la liquidación.</td>
</tr>
<tr>
<td>moneda</td>
<td>string</td>
<td>Código <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO</a> de la moneda. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_emision</td>
<td>int</td>
<td>Emisión normal: <code>1</code>.<br>Emisión por indisponibilidad: <code>2</code><br><strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='emisor-3'>Emisor</h3>
<p>Obitiene información del emisor de la liquidación de compra</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_buyer</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">ruc</span><span class="p">,</span>
  <span class="n">obligado_contabilidad</span><span class="p">,</span>
  <span class="n">contribuyente_especial</span><span class="p">,</span>
  <span class="n">nombre_comercial</span><span class="p">,</span>
  <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_establecimiento</span><span class="p">,</span>
  <span class="n">direccion_matriz</span>              <span class="n">direccion_emisor</span><span class="p">,</span>
  <span class="n">codigo_establecimiento</span>        <span class="n">codigo</span><span class="p">,</span>
  <span class="n">punto_emision</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>ruc</td>
<td>string</td>
<td>Número de RUC de 13 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>obligado_contabilidad</td>
<td>string</td>
<td><code>&#39;SI&#39;</code> si está obligado a llevar contabilidad. <code>&#39;NO&#39;</code> si no lo está.</td>
</tr>
<tr>
<td>contribuyente_especial</td>
<td>string</td>
<td>Número de resolución. En blanco <code>&#39;&#39;</code> si no es contribuyente especial.</td>
</tr>
<tr>
<td>nombre_comercial</td>
<td>string</td>
<td>Nombre comercial. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td></td>
<td></td>
</tr>
<tr>
<td>direccion_establecimiento</td>
<td>string</td>
<td>Dirección registrada en el SRI. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion_emisor</td>
<td>string</td>
<td>Dirección del punto de emisión. Máximo 300 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al establecimiento. Ejemplo: <code>001</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision</td>
<td>string</td>
<td>Código numérico de 3 caracteres que representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='proveedor'>Proveedor</h3>
<p>Obtiene información del proveedor de la liquidación de compra</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_provider</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">identificador_proveedor</span>                   <span class="n">identificacion</span><span class="p">,</span>
  <span class="n">tipo_identificador_proveedor</span>              <span class="n">tipo_identificacion</span><span class="p">,</span>
  <span class="n">razon_social_proveedor</span> <span class="n">razon_social</span><span class="p">,</span>
  <span class="n">direccion_proveedor</span> <span class="n">direccion</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>identificacion</td>
<td>string</td>
<td>De 5 a 20 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_identificacion</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>razon_social</td>
<td>string</td>
<td>Razón social. Máximo 300 caracteres <strong>Requerido</strong></td>
</tr>
<tr>
<td>direccion</td>
<td>string</td>
<td>Dirección</td>
</tr>
</tbody></table>
<h3 id='totales-3'>Totales</h3>
<p>Obtiene información de los valores totales de las liquidaciones</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_totals</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">total_sin_impuestos</span><span class="p">,</span>
  <span class="n">importe_total</span><span class="p">,</span>
  <span class="n">descuento</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>total_sin_impuestos</td>
<td>float</td>
<td>Total antes de los impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>importe_total</td>
<td>float</td>
<td>Total incluyendo impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>Suma de los descuentos de cada ítem y del descuento adicional. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-totales-3'>Impuestos de totales</h3>
<p>Obtiene información de los impuestos de los totales de la factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_totals_taxes</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">total_impuesto</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='items-3'>Items</h3>
<p>Obtiene todos los items de una factura</p>
<pre class="highlight sql tab-sql"><code><span class="n">items</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id</span> <span class="n">id_detalle</span><span class="p">,</span>
  <span class="n">codigo_principal</span><span class="p">,</span>
  <span class="n">codigo_auxiliar</span><span class="p">,</span>
  <span class="n">descripcion</span><span class="p">,</span>
  <span class="n">cantidad</span><span class="p">,</span>
  <span class="n">unidad_medida</span><span class="p">,</span>
  <span class="n">precio_unitario</span><span class="p">,</span>
  <span class="n">descuento</span><span class="p">,</span>
  <span class="n">precio_total_sin_impuestos</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">item</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td>int</td>
<td>Identifica de manera única el ítem o detalle de la factura. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_principal</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_auxiliar</td>
<td>string</td>
<td>Código alfanumérico de uso del comercio. Máximo 25 caracteres.</td>
</tr>
<tr>
<td>descripcion</td>
<td>string</td>
<td>Descripción del ítem. <strong>Requerido</strong></td>
</tr>
<tr>
<td>cantidad</td>
<td>float</td>
<td>Cantidad de items. <strong>Requerido</strong></td>
</tr>
<tr>
<td>unidad_medida</td>
<td>string</td>
<td>Unidad de medida. Ejemplo: Kilos.</td>
</tr>
<tr>
<td>precio_unitario</td>
<td>float</td>
<td>Precio unitario. <strong>Requerido</strong></td>
</tr>
<tr>
<td>descuento</td>
<td>float</td>
<td>El descuento es aplicado por cada producto.</td>
</tr>
<tr>
<td>precio_total_sin_impuestos</td>
<td>float</td>
<td>Precio antes de los impuestos. Se obtiene multiplicando la <code>cantidad</code> por el <code>precio_unitario</code> <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-items-3'>Impuestos de items</h3>
<p>Obtiene los impuestos de un item.</p>
<pre class="highlight sql tab-sql"><code><span class="n">item_taxes</span>  <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">id_item</span> <span class="n">id_detalle</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">valor</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">item_impuesto</span>
  <span class="k">WHERE</span>
  <span class="n">id_item</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Descripción</th>
<th>Valor de ejemplo</th>
</tr>
</thead><tbody>
<tr>
<td>id_detalle</td>
<td></td>
<td></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>valor</td>
<td>float</td>
<td>Valor del total. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>float</td>
<td>Porcentaje actual del impuesto expresado por un número entre 0.0 y 100.0 <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='detalles-adicionales-de-items-5'>Detalles adicionales de items</h3>
<p>Obtiene los detalles adicionales de un ítem.</p>

<p>Los detalles adicionales de un ítem se manejan de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Peso&#39;:&#39;Kg&#39;</p>

<p>Se asume que en la tabla consultada una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con detalles adicionales del ítem:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Peso</td>
<td>KG</td>
</tr>
<tr>
<td>Color</td>
<td>Rojo</td>
</tr>
<tr>
<td>Caducidad</td>
<td>10 días</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">item_details</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">nombre</span>    <span class="n">nombre</span><span class="p">,</span>
  <span class="n">valor</span>   <span class="n">valor</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">item_detalle_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_item</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>nombre</td>
<td>string</td>
<td>Nombre del detalle adicional del ítem</td>
</tr>
<tr>
<td>valor</td>
<td>string</td>
<td>Valor del detalle adicional del ítem</td>
</tr>
</tbody></table>
<h3 id='informacion-adicional-5'>Información adicional</h3>
<p>Obtiene la información adicional de la factura. Este query es <strong>opcional</strong></p>

<p>La información adicional de la factura se maneja de la forma &#39;Clave&#39;:&#39;Valor&#39;. Ejemplo: &#39;Tipo de pago&#39;:&#39;Cheque&#39;</p>

<p>Se asume que en la tabla consultada una columna tiene los nombres y otra los valores.</p>

<p>Ejemplo de columnas con información adicional de la liquidación:</p>

<table><thead>
<tr>
<th>columna_de_nombres</th>
<th>columna_de_valores</th>
</tr>
</thead><tbody>
<tr>
<td>Tipo de servicio</td>
<td>Avanzado</td>
</tr>
<tr>
<td>Forma de pago</td>
<td>Cheque</td>
</tr>
<tr>
<td>Periodo</td>
<td>3 meses</td>
</tr>
</tbody></table>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_additional_information</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">nombre</span>    <span class="n">_nombre_</span><span class="p">,</span>
  <span class="n">valor</span>     <span class="n">_valor_</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">info_adicional</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Campo</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td><code>_nombre_</code></td>
<td>string</td>
<td>Nombre de la información adicional de la factura</td>
</tr>
<tr>
<td><code>_valor_</code></td>
<td>string</td>
<td>Valor de la información adicional de la factura</td>
</tr>
</tbody></table>
<h3 id='pagos-2'>Pagos</h3>
<p>Obtiene la información de los pagos aplicables a la liquidación.</p>
<pre class="highlight sql tab-sql"><code><span class="n">payment_methods</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">forma_pago</span><span class="p">,</span>
  <span class="n">total</span> <span class="n">total</span><span class="p">,</span>
  <span class="n">unidad_tiempo</span><span class="p">,</span>
  <span class="n">plazo</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">pago</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>forma_pago</td>
<td>string</td>
<td>Código del <a href="#tipos-de-forma-de-pago">tipo de forma de pago</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total</td>
<td>float</td>
<td>Total aplicable a la forma de pago especificada. <strong>Requerido</strong></td>
</tr>
<tr>
<td>unidad_tiempo</td>
<td>string</td>
<td>Especifica la unidad de tiempo en la cual se expresa el plazo.</td>
</tr>
<tr>
<td>plazo</td>
<td>int</td>
<td>Especifica el plazo del tipo de pago.</td>
</tr>
</tbody></table>
<h3 id='reembolsos'>Reembolsos</h3>
<p>Obtiene el reembolso aplicable a una liquidación.</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_reimbursement</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">r</span><span class="p">.</span><span class="n">id_reembolso</span><span class="p">,</span>
  <span class="n">l</span><span class="p">.</span><span class="n">codigo_documento_reembolso</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span> <span class="k">AS</span> <span class="n">l</span> <span class="k">JOIN</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">reembolso</span> <span class="k">AS</span> <span class="n">r</span>
  <span class="k">ON</span>
  <span class="n">l</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">id_liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>r.id_reembolso</td>
<td>int</td>
<td>Identificador del reembolso. <strong>Reembolso</strong></td>
</tr>
<tr>
<td>l.codigo_documento_reembolso</td>
<td>Identificador del documento de reembolso. <strong>Reembolso</strong></td>
<td></td>
</tr>
</tbody></table>
<h3 id='totales-de-reembolosos'>Totales de reembolosos</h3>
<p>Obtiene la información de los totales de un reembolso</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_reimbursement_totals</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">total_comprobante_reembolso</span>            <span class="n">subtotal</span><span class="p">,</span>
  <span class="n">total_base_imponible_reembolso</span>         <span class="n">total</span><span class="p">,</span>
  <span class="n">total_impuesto_reembolso</span>               <span class="n">total_impuestos</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">liquidacion</span>
  <span class="k">WHERE</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>subtotal</td>
<td>float</td>
<td>Total del reembolso incluyendo base imponible e impuestos. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total</td>
<td>float</td>
<td>Total del reembolso incluyendo la base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>total_impuestos</td>
<td>float</td>
<td>Total del reembolso incluyendo los impuestos</td>
</tr>
</tbody></table>
<h3 id='documennto-reembolso'>Documennto reembolso</h3>
<p>Obtiene la información de un reembolso.</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_reimbursement_document</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo_documento_reembolso</span>            <span class="n">codigo</span><span class="p">,</span>
  <span class="n">id_reembolso</span>                          <span class="n">id_documento</span><span class="p">,</span>
  <span class="n">id_proveedor_reembolso</span><span class="p">,</span>
  <span class="n">tipo_id_proveedor_reembolso</span><span class="p">,</span>
  <span class="n">codigo_pais_pago_proveedor_reembolso</span><span class="p">,</span>
  <span class="n">tipo_proveedor_reembolso</span><span class="p">,</span>
  <span class="n">secuencia_reembolso</span><span class="p">,</span>
  <span class="n">punto_emision_reembolso</span><span class="p">,</span>
  <span class="n">fecha_emision_reembolso</span><span class="p">,</span>
  <span class="n">numero_autorizacion_reembolso</span><span class="p">,</span>
  <span class="n">codigo_establecimiento_reembolso</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">reembolso</span>
  <span class="k">WHERE</span>
  <span class="n">id_reembolso</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código numérico de 2 caracteres que representa al documento de reembolso. Ejemplo: <code>01</code> <strong>Requerido</strong></td>
</tr>
<tr>
<td>id_documento</td>
<td>int</td>
<td>Identifica de manera única al documento de reemoblso. <strong>Requerido</strong></td>
</tr>
<tr>
<td>id_proveedor_reembolso</td>
<td>string</td>
<td>Identifica de manera única al proveedor en la liquidación. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_id_proveedor_reembolso</td>
<td>string</td>
<td>Ver <a href="#tipo-de-identificacion">tabla</a> de tipos de identificación <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_pais_pago_proveedor_reembolso</td>
<td>string</td>
<td>Código de dos letras del país del proveedor según [ISO_3166](https://en.wikipedia.org/wiki/ <strong>Requerido</strong></td>
</tr>
<tr>
<td>tipo_proveedor_reembolso</td>
<td>string</td>
<td>Tipo de proveedor <strong>Requerido</strong></td>
</tr>
<tr>
<td>secuencia_reembolso</td>
<td>int</td>
<td>Número de secuencia de la factura. <strong>Requerido</strong></td>
</tr>
<tr>
<td>punto_emision_reembolso</td>
<td>string</td>
<td>Código numérico de 3 caracteres que  representa al punto de emisión, o punto de venta. Ejemplo: <code>001</code>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>fecha_emision_reembolso</td>
<td>datetime</td>
<td>Fecha de emisión <strong>Requerido</strong></td>
</tr>
<tr>
<td>numero_autorizacion_reembolso</td>
<td>string</td>
<td>Autorización del documento de reembolso. <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_establecimiento_reembolso</td>
<td>float</td>
<td>Número establecimiento que recibe la entrega. <strong>Requerido</strong></td>
</tr>
</tbody></table>
<h3 id='impuestos-de-reembolsos'>Impuestos de reembolsos</h3>
<p>Obtiene información de los impuestos de los reembolsos</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_reimbursement_tax</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">codigo</span><span class="p">,</span>
  <span class="n">codigo_porcentaje</span><span class="p">,</span>
  <span class="n">tarifa</span><span class="p">,</span>
  <span class="n">base_imponible</span><span class="p">,</span>
  <span class="n">impuesto_reembolso</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">reembolso_tax</span>
  <span class="k">WHERE</span>
  <span class="n">id_reembolso</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>codigo</td>
<td>string</td>
<td>Código del <a href="#tipos-de-impuesto">tipo de impuesto</a> <strong>Requerido</strong></td>
</tr>
<tr>
<td>codigo_porcentaje</td>
<td>string</td>
<td>Código del <a href="#codigo-de-porcentaje-de-iva">porcentaje</a>. <strong>Requerido</strong></td>
</tr>
<tr>
<td>tarifa</td>
<td>float</td>
<td>Porcentaje actual del impuesto expresado por un número entre 0.0 y 100.0 <strong>Requerido</strong></td>
</tr>
<tr>
<td>base_imponible</td>
<td>float</td>
<td>Base imponible. <strong>Requerido</strong></td>
</tr>
<tr>
<td>impuesto_reembolso</td>
<td>float</td>
<td>Valor del impuesto del reembolso</td>
</tr>
</tbody></table>
<h3 id='maquina-fiscal'>Máquina fiscal</h3>
<p>Obtiene información de la máquina fiscal con la que se emitió la liquidación</p>
<pre class="highlight sql tab-sql"><code><span class="n">purchase_settlement_fiscal_machine</span> <span class="o">=</span> <span class="k">SELECT</span>
  <span class="n">marca</span><span class="p">,</span>
  <span class="n">modelo</span><span class="p">,</span>
  <span class="n">serie</span>
  <span class="k">FROM</span>
  <span class="n">liquidaciones_compra</span><span class="p">.</span><span class="n">maquina_fiscal</span>
  <span class="k">WHERE</span>
  <span class="n">id_liquidacion</span> <span class="o">=</span> <span class="o">?</span>
</code></pre>
<table><thead>
<tr>
<th>Parámetro</th>
<th>Tipo</th>
<th>Descripción</th>
</tr>
</thead><tbody>
<tr>
<td>marca</td>
<td>string</td>
<td>Marca de máximo 100 caracteres</td>
</tr>
<tr>
<td>modelo</td>
<td>string</td>
<td>Modelo de máximo 100 caracteres</td>
</tr>
<tr>
<td>serie</td>
<td>string</td>
<td>Serie de máximo 100 caracteres</td>
</tr>
</tbody></table>
<h3 id='tablas-recomendadas-5'>Tablas recomendadas</h3>
<p>Estructura recomendada para las tablas o vistas con información de las liquidaciones de compra.</p>

<p>Ejemplo en SQL Server:</p>
<pre class="highlight sql tab-sql"><code><span class="k">CREATE</span> <span class="k">SCHEMA</span> <span class="n">liquidaciones_compra</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">ambiente</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">int</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">clave_acceso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">49</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">DATETIME</span><span class="p">]</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">moneda</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">15</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_documento</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- EMISOR</span>
    <span class="p">[</span><span class="n">ruc</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">obligado_contabilidad</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">10</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">contribuyente_especial</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">13</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">nombre_comercial</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_matriz</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_establecimiento</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- PROVEEDOR</span>
    <span class="p">[</span><span class="n">tipo_identificador_proveedor</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">razon_social_proveedor</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">identificador_proveedor</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">direccion_proveedor</span><span class="p">]</span> <span class="p">[</span><span class="n">vARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- TOTALES</span>
    <span class="p">[</span><span class="n">total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">importe_total</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="c1">-- REEMBOLSO</span>
    <span class="p">[</span><span class="n">codigo_documento_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_comprobante_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_base_imponible_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total_impuesto_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo_principal</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">25</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_auxiliar</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">25</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descripcion</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">300</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">unidad_medida</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">50</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">cantidad</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_unitario</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">precio_total_sin_impuestos</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>  <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDIACION: DETALLES ADICIONALES DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item_detalle_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_items_detalles_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: IMPUESTOS DE ITEMS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_item</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">item</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span> <span class="c1">-- porcentaje</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_item_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_item</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: IMPUESTOS TOTALES</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">total_impuesto</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">descuento_adicional</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_total_impuesto</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_liquidacion</span><span class="p">,</span> <span class="n">codigo</span><span class="p">,</span> <span class="n">codigo_porcentaje</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDIACION: PAGOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">pago</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">forma_pago</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">total</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">plazo</span><span class="p">]</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">unidad_tiempo</span><span class="p">]</span> <span class="n">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: REEMBOLSOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">reembolso</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_reembolso</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">tipo_id_proveedor_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">id_proveedor_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_pais_pago_proveedor_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tipo_proveedor_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_documento_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_establecimiento_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">punto_emision_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">3</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">secuencial_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">fecha_emision_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DATETIME</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">numero_autorizacion_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">49</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: REEMBOLSO IMPUESTOS</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">reembolso_tax</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">reembolso</span><span class="p">](</span><span class="n">id_reembolso</span><span class="p">),</span>
    <span class="p">[</span><span class="n">codigo</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">codigo_porcentaje</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">tarifa</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">base_imponible</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">impuesto_reembolso</span><span class="p">]</span> <span class="p">[</span><span class="n">DECIMAL</span><span class="p">](</span><span class="mi">14</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: MAQUINA FISCAL</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">maquina_fiscal</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="n">bigint</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">marca</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">modelo</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">serie</span><span class="p">]</span> <span class="p">[</span><span class="n">VARCHAR</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_maquina_fiscal</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">marca</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">-- LIQUIDACION: INFO ADICIONAL</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">info_adicional</span><span class="p">](</span>
    <span class="p">[</span><span class="n">id_liquidacion</span><span class="p">]</span> <span class="p">[</span><span class="n">bigint</span><span class="p">]</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="k">REFERENCES</span> <span class="p">[</span><span class="n">liquidaciones_compra</span><span class="p">].[</span><span class="n">liquidacion</span><span class="p">](</span><span class="n">id</span><span class="p">),</span>
    <span class="p">[</span><span class="n">nombre</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">](</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="p">[</span><span class="n">valor</span><span class="p">]</span> <span class="p">[</span><span class="n">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">pk_info_adicionales</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">id_liquidacion</span><span class="p">,</span> <span class="n">nombre</span><span class="p">)</span>
<span class="p">)</span>
</code></pre><h2 id='consulta-de-documentos'>Consulta de documentos</h2>
<p>La información que Link consulta cuando un documento ha sido emitido y el query <code>on_status_update</code> ha sido definido son los mismos detallados en la <a href="https://datil.dev/#envio-sri">consulta de documentos</a>. Se puede acceder y personalizar la sentencia SQL utilizando las etiquetas <a href="http://jinja.pocoo.org/">Jinja2</a></p>

<blockquote>
<h4 id='ejemplo-para-guardar-autorizacion-de-facturas'>Ejemplo para guardar autorizacion de facturas</h4></blockquote>
<pre class="highlight sql tab-sql"><code><span class="n">on_status_update</span> <span class="o">=</span> <span class="err">{</span><span class="o">%</span> <span class="n">if</span> <span class="n">autorizacion</span> <span class="k">is</span> <span class="k">defined</span> <span class="o">%</span><span class="err">}</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">dbo</span><span class="p">.</span><span class="n">RESPUESTA_SRI_FACTURSA</span> <span class="p">(</span>
  <span class="n">id</span><span class="p">,</span>
  <span class="n">numero</span><span class="p">,</span>
  <span class="n">clave_acceso</span><span class="p">,</span>
  <span class="n">codig_estado</span>
<span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span>
  <span class="err">{{</span> <span class="n">id_local</span> <span class="err">}}</span><span class="p">,</span>
  <span class="err">{{</span> <span class="n">autorzacio</span><span class="p">.</span><span class="n">numero</span> <span class="err">}}</span><span class="p">,</span>
  <span class="err">{</span><span class="o">%</span> <span class="n">if</span> <span class="n">autorizacion</span><span class="p">.</span><span class="n">numero</span> <span class="o">==</span> <span class="s1">'AUTORIZADO'</span> <span class="o">%</span><span class="err">}</span> 
    <span class="mi">100</span>
  <span class="err">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="err">}</span>
    <span class="mi">0</span>
  <span class="err">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="err">}</span>
<span class="p">)</span>
</code></pre>